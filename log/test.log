  [1m[35m (2.4ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35mSQL (1.8ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.8ms)[0m  [1m[35mDROP TABLE IF EXISTS "products" CASCADE[0m
  [1m[35m (10.6ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230122215226)[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20230122214706);

[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 02:59:10.959105"], ["updated_at", "2023-01-27 02:59:10.959105"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "bf0832e6bcc5431ec2a15d8f75d9aa2ab021e9a5"], ["created_at", "2023-01-27 02:59:10.962894"], ["updated_at", "2023-01-27 02:59:10.962894"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5426.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (97.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (187.8ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35m (9.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateUsers (20230122214706)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230122214706"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230122215226)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230122215226"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 03:00:40.370750"], ["updated_at", "2023-01-27 03:00:40.370750"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5422.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5430.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "products" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:04:15.875345', '2023-01-27 03:04:15.875345'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:04:15.875345', '2023-01-27 03:04:15.875345'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:04:15.875345', '2023-01-27 03:04:15.875345');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$04$igmXZYfURvW4Y7zta95YdOdG0Ly1IFHhOWFlIOTk3qY4MJeCBGbgG,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:04:15.879647', '2023-01-27 03:04:15.879647'), (135138680, 'admin,', '$2a$04$ymA/uAzWdvRdJaHovxUjSOZktiYrxn4MehoAGwtodW.lT5gHuwvUG,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:04:15.879647', '2023-01-27 03:04:15.879647'), (369520569, 'stocker1,', '$2a$04$RJmmn9RFdnPkXuIRqdbA3.tG64NEnfciGLuCLjm3noHliimtxb1w2,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:04:15.879647', '2023-01-27 03:04:15.879647'), (252657165, 'stocker2,', '$2a$04$nkFgpK4JF5IB5r62S/2rXO4AKUA2y0p40kk7B2fAWwIwapoVw32sK,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:04:15.879647', '2023-01-27 03:04:15.879647')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "products" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5422.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "products" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:05:29.148664', '2023-01-27 03:05:29.148664'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:05:29.148664', '2023-01-27 03:05:29.148664'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:05:29.148664', '2023-01-27 03:05:29.148664');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$04$PGWGZg2WPVNUa2Vs.aC8LuBag0nY2K51oNlWC4CpctPtq9h.3.V9q,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:05:29.153084', '2023-01-27 03:05:29.153084'), (135138680, 'admin,', '$2a$04$bqRRJHAQH2w3smQu6aThLO9FF79Zse57/Bt6MAybq0lGMV54twkEa,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:05:29.153084', '2023-01-27 03:05:29.153084'), (369520569, 'stocker1,', '$2a$04$mz15DbY5ruNQ.qmU9ML7HObPD1N2MrsuFMFT4.cqoqTtAjP1dZ/J6,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:05:29.153084', '2023-01-27 03:05:29.153084'), (252657165, 'stocker2,', '$2a$04$Xhw/Jy9n0tyNf2V.qgHV0eYguZg3KsE6fWPCYhMLFvvppivBJfERy,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:05:29.153084', '2023-01-27 03:05:29.153084')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "products" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5434.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "products" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:07:01.684025', '2023-01-27 03:07:01.684025'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:07:01.684025', '2023-01-27 03:07:01.684025'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:07:01.684025', '2023-01-27 03:07:01.684025');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$04$rWxCsb2fcMRdHktconREB.AM9zpSJrHPA4xduRLkFbqcdInN6kAJa,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:07:01.690012', '2023-01-27 03:07:01.690012'), (135138680, 'admin,', '$2a$04$Z.499m0MZl7LuXnT5CTOV.wL0Jo3nYt5d4wZn9aovnkECIY7kpIzG,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:07:01.690012', '2023-01-27 03:07:01.690012'), (369520569, 'stocker1,', '$2a$04$2jbS6yOQJ67s7Gw55CHTSOU5SGz9qdFwjSm9ThG5ggFdc8EQWlwHq,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:07:01.690012', '2023-01-27 03:07:01.690012'), (252657165, 'stocker2,', '$2a$04$80UHJGLWXQgAM5mlkdpM5eyl4y6U2o.lrb2kEyrWmN93GMmysUP8K,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:07:01.690012', '2023-01-27 03:07:01.690012')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "products" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:07:02 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos,", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos,", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos,"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.2ms | Allocations: 582)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5431.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5435.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (98.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (179.6ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "products" CASCADE[0m
  [1m[35m (11.4ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230122215226)[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20230122214706);

[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 03:14:16.282736"], ["updated_at", "2023-01-27 03:14:16.282736"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "bf0832e6bcc5431ec2a15d8f75d9aa2ab021e9a5"], ["created_at", "2023-01-27 03:14:16.286447"], ["updated_at", "2023-01-27 03:14:16.286447"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:15:07.588426', '2023-01-27 03:15:07.588426'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:15:07.588426', '2023-01-27 03:15:07.588426'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:15:07.588426', '2023-01-27 03:15:07.588426');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$12$2VJLhQAJBpA4OdM6i5hd3ukJAgF.UZpdo.lbOUtsIqHEmli2YZouS,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:15:07.592770', '2023-01-27 03:15:07.592770'), (135138680, 'admin,', '$2a$12$vWk0IFiQLzQtIK8/6UORl.hJrNUzhUREtyWwJruvcc7OvfAgplzda,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:07.592770', '2023-01-27 03:15:07.592770'), (369520569, 'stocker1,', '$2a$12$SKpKH7vxs4bGoM2NpB53SeCP7kFmAHLRb.NABkZGW12/axHREoxqG,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:07.592770', '2023-01-27 03:15:07.592770'), (252657165, 'stocker2,', '$2a$12$wApBelVqve4y3AfLYpSKPuiyFMYjMHfxDueO/cTYwzWni4tY2mp66,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:07.592770', '2023-01-27 03:15:07.592770')[0m
  [1m[36mTRANSACTION (23.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:15:07 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos,", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos,", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos,"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.2ms | Allocations: 581)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (94.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (178.1ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "products" CASCADE[0m
  [1m[35m (10.7ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230122215226)[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20230122214706);

[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 03:15:43.935497"], ["updated_at", "2023-01-27 03:15:43.935497"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "bf0832e6bcc5431ec2a15d8f75d9aa2ab021e9a5"], ["created_at", "2023-01-27 03:15:43.939137"], ["updated_at", "2023-01-27 03:15:43.939137"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:15:59.384553', '2023-01-27 03:15:59.384553'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:15:59.384553', '2023-01-27 03:15:59.384553'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:15:59.384553', '2023-01-27 03:15:59.384553');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$04$QeAmQXiDSLkDuSMZLhXyjOg91cLVt3HpKBNW69ooKb.sz6e/ZAIx2,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:15:59.388930', '2023-01-27 03:15:59.388930'), (135138680, 'admin,', '$2a$04$5bUJEPr0jRUY50dYt7wHaOPkBm8EfG/KBSM4lT9NI3RR5ogJ4LYFa,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:59.388930', '2023-01-27 03:15:59.388930'), (369520569, 'stocker1,', '$2a$04$A7B9AV1DhtSWPh6XnlRF2.FlLX4K6Tmm8FkjnukdvQWpOJ5Z6.Oei,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:59.388930', '2023-01-27 03:15:59.388930'), (252657165, 'stocker2,', '$2a$04$.Ar9EOabDar4FULTzo6lL.1eYPzNdowr1vd8TljrbE0HkYCLa03Ca,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:15:59.388930', '2023-01-27 03:15:59.388930')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:15:59 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos,", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos,", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos,"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.2ms | Allocations: 576)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars,', 5, 80, NULL, '2023-01-27 03:16:37.044035', '2023-01-27 03:16:37.044035'), (1044824035, 'Twix,', 0, 95, NULL, '2023-01-27 03:16:37.044035', '2023-01-27 03:16:37.044035'), (209893330, 'Kit Kat,', 2, 125, NULL, '2023-01-27 03:16:37.044035', '2023-01-27 03:16:37.044035');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos,', '$2a$04$YQzMWYUdZfrauXpyXSOpA.k/cbWR97zRM.ZU9x1VEVdpq6XgSaFtO,', 'mingos@mail.com,', NULL, 10, DEFAULT, '2023-01-27 03:16:37.048158', '2023-01-27 03:16:37.048158'), (135138680, 'admin,', '$2a$04$5.PqF9aTJQ5aLDL0V0UPteps4hmQbCVi7p3D9rMOWmfExuqyKj3.2,', 'admin@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:16:37.048158', '2023-01-27 03:16:37.048158'), (369520569, 'stocker1,', '$2a$04$OBHg5n/KMB2SsZUQJYX6B.7NV3ATSE0nqu.zl/gRHTrNvqLy/eRTC,', 'stocker1@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:16:37.048158', '2023-01-27 03:16:37.048158'), (252657165, 'stocker2,', '$2a$04$uoEsBEUn3XbgZ7BQyob4aOxJs1RWzp5Q4LPCm5jgkmmyCRCTpP.Aq,', 'stocker2@mail.com,', NULL, 0, DEFAULT, '2023-01-27 03:16:37.048158', '2023-01-27 03:16:37.048158')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:16:37 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos,", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos,", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos,"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 29586ms (ActiveRecord: 0.2ms | Allocations: 115574)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (100.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (179.7ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "products" CASCADE[0m
  [1m[35m (10.4ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230122215226)[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20230122214706);

[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 03:18:05.602136"], ["updated_at", "2023-01-27 03:18:05.602136"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "bf0832e6bcc5431ec2a15d8f75d9aa2ab021e9a5"], ["created_at", "2023-01-27 03:18:05.606351"], ["updated_at", "2023-01-27 03:18:05.606351"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, NULL, '2023-01-27 03:18:23.273609', '2023-01-27 03:18:23.273609'), (1044824035, 'Twix', 0, 95, NULL, '2023-01-27 03:18:23.273609', '2023-01-27 03:18:23.273609'), (209893330, 'Kit Kat', 2, 125, NULL, '2023-01-27 03:18:23.273609', '2023-01-27 03:18:23.273609');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$6RaWLxp5OQX82aB5bmOCj.ASVjRjMeFO92FnyP8lTlrPC/xF/K7Zu', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:18:23.277832', '2023-01-27 03:18:23.277832'), (135138680, 'admin', '$2a$04$Vm8qzhcn.VGb531dRk6hweR1wF4sY96kBDKYZngdPakkTZo1Zs4rq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:18:23.277832', '2023-01-27 03:18:23.277832'), (369520569, 'stocker1', '$2a$04$FnOOFqaTt8SaKeYjcl0NNeJqBgBBV7SQZyTFIb04L0f1RxSTDmvVC', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:18:23.277832', '2023-01-27 03:18:23.277832'), (252657165, 'stocker2', '$2a$04$Bg8cl1zsECgTrQGUagfFRehUjzk8y2BjnbeqiYTJLi4FF7NDyFDMG', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:18:23.277832', '2023-01-27 03:18:23.277832')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:18:23 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "U3aFJs9Z4c1TqtAwCWNfcQgT"], ["updated_at", "2023-01-27 03:18:23.804559"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2431)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:19:54.784274', '2023-01-27 03:19:54.784274'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:19:54.784274', '2023-01-27 03:19:54.784274'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:19:54.784274', '2023-01-27 03:19:54.784274');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$YJONNcOajnigzchHdsuES.fYvk3VE6ZOQSBudnXgZYcpCN.Ufkuoy', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:19:54.793524', '2023-01-27 03:19:54.793524'), (135138680, 'admin', '$2a$04$CE/N4M8YlAMD6ZJgzYvtPe1jBTdkMu6Q6umI4ICsMbbhhfkeiooXu', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:19:54.793524', '2023-01-27 03:19:54.793524'), (369520569, 'stocker1', '$2a$04$/hE.efhALzr80SoKfHpZ6u96bbKqLUXzKA1vw5rM2I8Om5LtTj12O', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:19:54.793524', '2023-01-27 03:19:54.793524'), (252657165, 'stocker2', '$2a$04$4QnyGA0vtqsZ9cGxPLou8e/BPWOAqwOzpEErmKlbla8VqVph.30NO', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:19:54.793524', '2023-01-27 03:19:54.793524')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:19:55 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "LhAgKzMN4Hu4HEYzyT9P4LEt"], ["updated_at", "2023-01-27 03:19:55.322182"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2430)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:20:15.301927', '2023-01-27 03:20:15.301927'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:20:15.301927', '2023-01-27 03:20:15.301927'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:20:15.301927', '2023-01-27 03:20:15.301927');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$MSKw2oS4EXFWpGCtVJITn.uuf3HyQ8cv7dSLrzHuzTYMHYVjv2Ldq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:20:15.306988', '2023-01-27 03:20:15.306988'), (135138680, 'admin', '$2a$04$l7h1kmFh6uJvrgk/xAJ05.R42qWVrckeH9ADOHl3CW4.kr./PFxIy', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:20:15.306988', '2023-01-27 03:20:15.306988'), (369520569, 'stocker1', '$2a$04$3oLcj6pg8GoBalIF2siF7us1M32yxTCmlFR7dC4FvbkVYgDPiwL32', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:20:15.306988', '2023-01-27 03:20:15.306988'), (252657165, 'stocker2', '$2a$04$Q5GSQA.yNHLTxooebGddX.Pkoo5IOjGhVFgYxlF0IGZwUhAyqzbn6', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:20:15.306988', '2023-01-27 03:20:15.306988')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:20:15 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "6uW9jVRZoHazuPxN3QcCsYT2"], ["updated_at", "2023-01-27 03:20:15.866678"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2432)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:20:34.798427', '2023-01-27 03:20:34.798427'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:20:34.798427', '2023-01-27 03:20:34.798427'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:20:34.798427', '2023-01-27 03:20:34.798427');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$2obj0CijlkZLhqT2llCQ8eKM08J2NyvnMwU1qh.Jah.T7LEF5AEX2', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:20:34.802868', '2023-01-27 03:20:34.802868'), (135138680, 'admin', '$2a$04$cev5Sc1sX2IGVWQ5wVj2QuWtWwCI6AGLIKnyThsik4/m30oWLrWQi', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:20:34.802868', '2023-01-27 03:20:34.802868'), (369520569, 'stocker1', '$2a$04$k7pWFSVt5Hj9S1o4G1pw0ub.nrDFoCsVHsgiHxX/ijvjH/sIt6Xoe', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:20:34.802868', '2023-01-27 03:20:34.802868'), (252657165, 'stocker2', '$2a$04$yD0d.8jO35CSVAiB1X7/ieaV4YJJQ3GSI6QRcSFpR7A1j12p39gbG', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:20:34.802868', '2023-01-27 03:20:34.802868')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:20:35 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "MtLN9gnbsPHXsubNNykKXi6R"], ["updated_at", "2023-01-27 03:20:35.331379"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:20:35 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>50, "user"=>{"deposit"=>50}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2272)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:21:31.067023', '2023-01-27 03:21:31.067023'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:21:31.067023', '2023-01-27 03:21:31.067023'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:21:31.067023', '2023-01-27 03:21:31.067023');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$xVfT83zKLJ6e7J1kYHmDSOm7uV/2sMbgUz3bHj0A3YgOjyYdUnSUG', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:21:31.071409', '2023-01-27 03:21:31.071409'), (135138680, 'admin', '$2a$04$w2iDIA5150I9Mvxg5nf.8.nhiUtdQKuUpQS6B7QkhvbVydqJGQtde', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:21:31.071409', '2023-01-27 03:21:31.071409'), (369520569, 'stocker1', '$2a$04$osmvtLdbJ8rw3Ki66tvy4.H5wc0j1Ep3AtQ4/Ed6GF3NORteSfz42', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:21:31.071409', '2023-01-27 03:21:31.071409'), (252657165, 'stocker2', '$2a$04$SlURc9Q1LUsfWe4qIr/.ceIoHjMINRMdYKiWIgxPVTkgTXPcJw8dW', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:21:31.071409', '2023-01-27 03:21:31.071409')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:21:31 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "12YKJ4vHFoxz3UaWGAZ1aYV8"], ["updated_at", "2023-01-27 03:21:31.600511"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2424)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:21:31 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>50, "user"=>{"deposit"=>50}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 48227ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 130948)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:22:34.488714', '2023-01-27 03:22:34.488714'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:22:34.488714', '2023-01-27 03:22:34.488714'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:22:34.488714', '2023-01-27 03:22:34.488714');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$AlhSazTBz8KOPk7hOueIvey5X1Sw6.PQb6QdygpEVEhX7MHeiBxkC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:22:34.492906', '2023-01-27 03:22:34.492906'), (135138680, 'admin', '$2a$04$fQ6318kMNMch5etIY6gtE.9LzFXIlGfsyv8dp9RO7013AVrRoKiY6', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:22:34.492906', '2023-01-27 03:22:34.492906'), (369520569, 'stocker1', '$2a$04$8W3CobI1A0i3fE0r0ySN5uMMhM0u9TZidxFbXPSoD1p0swDcOftm.', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:22:34.492906', '2023-01-27 03:22:34.492906'), (252657165, 'stocker2', '$2a$04$ScKJfmerOY6Ooyq7k1KQq.QTPsUbBmPL1P8YyNdxUM7xYFtZ45XBu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:22:34.492906', '2023-01-27 03:22:34.492906')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:22:34 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "bSBDdPY3pLq8PWcYVGJDjBuQ"], ["updated_at", "2023-01-27 03:22:35.023456"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2391)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:22:35 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>50, "user"=>{"deposit"=>50}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 50], ["updated_at", "2023-01-27 03:22:35.053691"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1298)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:22:57.127295', '2023-01-27 03:22:57.127295'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:22:57.127295', '2023-01-27 03:22:57.127295'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:22:57.127295', '2023-01-27 03:22:57.127295');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$c51nBbjNajYKaVgKmlgDSOxocemsKr/3/qtiMqks/4mqnjmEn2UbW', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:22:57.131578', '2023-01-27 03:22:57.131578'), (135138680, 'admin', '$2a$04$kGHvGGu7O2MotXO1yul7OOUZ3AVXxIbycZo8x.uhOv.VotYtlCpFO', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:22:57.131578', '2023-01-27 03:22:57.131578'), (369520569, 'stocker1', '$2a$04$2oMjmd/Uxy/w.0dy8D5yie5GvJoQgrmaapp37W/UgvazaOaewcIkS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:22:57.131578', '2023-01-27 03:22:57.131578'), (252657165, 'stocker2', '$2a$04$lJGjfDU2OnnlDY1D2Do1bOX489RBLHTxxgREeKSg.f0TWMswgqeGG', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:22:57.131578', '2023-01-27 03:22:57.131578')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:22:57 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "KXzoqGmTHpLatpV644CdBzKJ"], ["updated_at", "2023-01-27 03:22:57.664803"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:22:57 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>50, "user"=>{"deposit"=>50}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 50], ["updated_at", "2023-01-27 03:22:57.688155"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1277)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:25:29.896290', '2023-01-27 03:25:29.896290'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:25:29.896290', '2023-01-27 03:25:29.896290'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:25:29.896290', '2023-01-27 03:25:29.896290');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$Sd4cSnqvKuA3r9w19P5M6OB5MIb1FyxVHZ.q1zinsJ4oz92hTQIGq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:25:29.900400', '2023-01-27 03:25:29.900400'), (135138680, 'admin', '$2a$04$DSUxgD5wOoBwwFUSaCvliuodEio0HYkCFWUzQEb4IbBBWz/4iAZM2', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:25:29.900400', '2023-01-27 03:25:29.900400'), (369520569, 'stocker1', '$2a$04$wN9Tmh4nRfZ5yFF3pskIF.Uny06iet463xMb.jWbfx5soI1FfJboa', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:25:29.900400', '2023-01-27 03:25:29.900400'), (252657165, 'stocker2', '$2a$04$XscICPmmbXNEegRxQSzPRO9cVyP1WTtvJZo34wsTK.2nLiMLtUsHe', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:25:29.900400', '2023-01-27 03:25:29.900400')[0m
  [1m[36mTRANSACTION (15.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:25:30 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "wFFPiKsTxZLHMZTmBTjWbaxM"], ["updated_at", "2023-01-27 03:25:30.445561"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2430)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:25:30 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>50, "user"=>{"deposit"=>50}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 50], ["updated_at", "2023-01-27 03:25:30.468722"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1277)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:26:36.878617', '2023-01-27 03:26:36.878617'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:26:36.878617', '2023-01-27 03:26:36.878617'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:26:36.878617', '2023-01-27 03:26:36.878617');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$VO296w7Ed/8jtGj1mhyeeOkgllIz8aSXr2BhvhtjSdifmb0r885Km', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:26:36.882966', '2023-01-27 03:26:36.882966'), (135138680, 'admin', '$2a$04$eIed7gLAq1lKjpcJncJzX.RovnMadbg.xVtiOZvdA.Tek2Q.cPUHi', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:26:36.882966', '2023-01-27 03:26:36.882966'), (369520569, 'stocker1', '$2a$04$kpJ2lUJzHoxVbPfl/kcnYO02UPxs9.ipWBLeLzZp93wMDm43Mn8Hq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:26:36.882966', '2023-01-27 03:26:36.882966'), (252657165, 'stocker2', '$2a$04$hylF.rIORz.til0q4ex4PuofvZtrv3m.y5WyYjfIo1Trnk9ces8E2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:26:36.882966', '2023-01-27 03:26:36.882966')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:26:37 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "NzUmPAz9qsbWPFVd8jCbzNYr"], ["updated_at", "2023-01-27 03:26:37.499013"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 2430)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:26:37 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 100], ["updated_at", "2023-01-27 03:26:37.523399"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1277)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:26:51.364292', '2023-01-27 03:26:51.364292'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:26:51.364292', '2023-01-27 03:26:51.364292'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:26:51.364292', '2023-01-27 03:26:51.364292');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$GtGbb1WtI9vnGnN/xdpgg.d3FGCzbPbJWcS79z85HAxPvm.NWGIL.', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:26:51.369608', '2023-01-27 03:26:51.369608'), (135138680, 'admin', '$2a$04$S91Udk2ujxzxN2sG6G.AzulD3QMySD2xR/FGOeFSBBFWZfKTlLxt.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:26:51.369608', '2023-01-27 03:26:51.369608'), (369520569, 'stocker1', '$2a$04$KSccqqP0Ppjo3t.OwpEJaOORTG94V1eYesAsh7Di9LSwc1ExtoTDa', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:26:51.369608', '2023-01-27 03:26:51.369608'), (252657165, 'stocker2', '$2a$04$2H8kVkqB7qokk/w9jeyOoe5hLbvLmkYlFH//O0r3g7ek70vSNWwQu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:26:51.369608', '2023-01-27 03:26:51.369608')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:26:51 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "1EVS5CNh55vRJQnV7cVdpY9K"], ["updated_at", "2023-01-27 03:26:51.950868"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2432)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:26:51 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 100], ["updated_at", "2023-01-27 03:26:51.977687"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1277)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (93.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "vending_machine_test"[0m
  [1m[35m (180.7ms)[0m  [1m[35mCREATE DATABASE "vending_machine_test" ENCODING = 'unicode' TEMPLATE = "template0"[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "products" CASCADE[0m
  [1m[35m (10.6ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "amount_available" integer, "cost" integer, "seller_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "username" character varying, "password_digest" character varying, "email" character varying, "role" integer DEFAULT 1, "deposit" integer DEFAULT 0, "auth_token" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230122215226)[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20230122214706);

[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-01-27 03:28:19.028919"], ["updated_at", "2023-01-27 03:28:19.028919"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "bf0832e6bcc5431ec2a15d8f75d9aa2ab021e9a5"], ["created_at", "2023-01-27 03:28:19.032593"], ["updated_at", "2023-01-27 03:28:19.032593"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(5168336399612003310)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, NULL, '2023-01-27 03:28:44.855787', '2023-01-27 03:28:44.855787'), (1044824035, 'Twix', 0, 95, NULL, '2023-01-27 03:28:44.855787', '2023-01-27 03:28:44.855787'), (209893330, 'Kit Kat', 2, 125, NULL, '2023-01-27 03:28:44.855787', '2023-01-27 03:28:44.855787');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$iBiOBanZrwtbf9CtyesIYeKRPx.k/qUaLlG9pLP3.obme2HKTupU.', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:28:44.860220', '2023-01-27 03:28:44.860220'), (135138680, 'admin', '$2a$04$DBMj3PUA0kgwbqy1AHqUjOiFo4CkWImwrjiEx0vabM/yte8vdnzeC', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:28:44.860220', '2023-01-27 03:28:44.860220'), (369520569, 'stocker1', '$2a$04$ySDhKx/XOV1XfTscRu9MP.1dUBbvHC/Xe3FtDWRQHz6vdJS0vrrNe', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:28:44.860220', '2023-01-27 03:28:44.860220'), (252657165, 'stocker2', '$2a$04$O4zlbr1fs6hoBYb6Ca9Xt.UkzZQbh08SrmaJi1f9QadSr8o2Z6R9G', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:28:44.860220', '2023-01-27 03:28:44.860220')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:28:57 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "S6C7S2YzQEe171FKGSd6aPGf"], ["updated_at", "2023-01-27 03:28:57.321650"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 25ms (Views: 0.7ms | ActiveRecord: 2.3ms | Allocations: 163475)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:28:57 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 100], ["updated_at", "2023-01-27 03:28:57.372423"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.7ms | ActiveRecord: 2.3ms | Allocations: 150173)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:29:45.580298', '2023-01-27 03:29:45.580298'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:29:45.580298', '2023-01-27 03:29:45.580298'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:29:45.580298', '2023-01-27 03:29:45.580298');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$UL9fIDR5DvTdmyInDTenLuM.x6RwX8JCur90Rw7gKIY4jaQYcrDSa', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:29:45.584389', '2023-01-27 03:29:45.584389'), (135138680, 'admin', '$2a$04$VvgTIlVFsS2C1RTS3OGFGuOeLAh8sVMxNKk0xeWocMDSuo2ZXkmPe', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:29:45.584389', '2023-01-27 03:29:45.584389'), (369520569, 'stocker1', '$2a$04$zirII/0f8iwXcwEUCWTic.Nf6lb34V/Xf8g4aMJzUN4Hkkl3LAwoW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:29:45.584389', '2023-01-27 03:29:45.584389'), (252657165, 'stocker2', '$2a$04$zY1bVluIYS8xQyJC3vx34u22EUGBbCM.GMvbW7hGsSorGGnxzf.9C', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:29:45.584389', '2023-01-27 03:29:45.584389')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:30:04 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "mz8ezR6wPcUZPEfNnhhT4pq8"], ["updated_at", "2023-01-27 03:30:04.683496"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 3025)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:30:04 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 100], ["updated_at", "2023-01-27 03:30:04.707274"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1301)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:30:26.708374', '2023-01-27 03:30:26.708374'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:30:26.708374', '2023-01-27 03:30:26.708374'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:30:26.708374', '2023-01-27 03:30:26.708374');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$LomRPf9g.qLOXA1t/eohF.c7/.nUT0.FVU2V1hu56l7B3QlVoFZge', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:30:26.712846', '2023-01-27 03:30:26.712846'), (135138680, 'admin', '$2a$04$O/JcctOJxUA6u8dAhmB4h.ycKDpw27//iklAGVEmUhMAH8cmMQLFa', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:30:26.712846', '2023-01-27 03:30:26.712846'), (369520569, 'stocker1', '$2a$04$a5wGmYtAQSvdakfOPiWhxejE1VjKJT2GgMeQ/xFdzHXLFRfG/smwi', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:30:26.712846', '2023-01-27 03:30:26.712846'), (252657165, 'stocker2', '$2a$04$XSzAY5PK.6zs5OWpWSRnoul.0cHdPb2j3e5HQQFoaCj6K/3VIBJuK', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:30:26.712846', '2023-01-27 03:30:26.712846')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:30:32 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "gAzWQDQycPY5UXcyW9tf9nT7"], ["updated_at", "2023-01-27 03:30:32.446604"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 3083)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:30:41 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 100], ["updated_at", "2023-01-27 03:30:41.397876"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1341)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:30:53.274719', '2023-01-27 03:30:53.274719'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:30:53.274719', '2023-01-27 03:30:53.274719'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:30:53.274719', '2023-01-27 03:30:53.274719');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$Iz8CJLM0FeEmx05Tdlj6JOLuQdkWLW5FCY1acB7tYnNIqXNoQNqHa', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:30:53.279099', '2023-01-27 03:30:53.279099'), (135138680, 'admin', '$2a$04$ri.0/f.EU78L6lInnQiac.jP6EU7ncyzWDFhQEWXMlGfViAPsuMvy', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:30:53.279099', '2023-01-27 03:30:53.279099'), (369520569, 'stocker1', '$2a$04$PWf6UOFDZ7swtMoY9h2UeeC14pCw6Yy9G6.xyW/u3rgO8oHWQabbK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:30:53.279099', '2023-01-27 03:30:53.279099'), (252657165, 'stocker2', '$2a$04$3WsdwbDQpNSKxZLN2I5aI.Ky6RFEPgJDcB6ekbsXncLJZCYTEzlp.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:30:53.279099', '2023-01-27 03:30:53.279099')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:30:54 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "5mMAX8k4eu5JvqaWKsG4yjUD"], ["updated_at", "2023-01-27 03:30:54.949945"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 3145)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:30:58 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "5mMAX8k4eu5JvqaWKsG4yjUD"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 03:30:58.284291"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1295)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:32:26.694727', '2023-01-27 03:32:26.694727'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:32:26.694727', '2023-01-27 03:32:26.694727'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:32:26.694727', '2023-01-27 03:32:26.694727');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$vANre0HO9Mm612xKgYFFMOwDxnUCQQVAAUttPJCVxI2CRfP6GkIqa', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:32:26.699405', '2023-01-27 03:32:26.699405'), (135138680, 'admin', '$2a$04$WOsYnKExlS5JaXTtRfcL.OPtPg5iBzll1Wq6Le46PnALb9cDvOtQO', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:32:26.699405', '2023-01-27 03:32:26.699405'), (369520569, 'stocker1', '$2a$04$8T2gOIWpl5MPKn.T7mrkD.Ryjd0q9r1o1S15B.cw5o/qxd3VRVqPW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:32:26.699405', '2023-01-27 03:32:26.699405'), (252657165, 'stocker2', '$2a$04$bEzm2kyo3tR2r7OgoKGLduwYCoaJLUKnjLpPCJuH8j4TB4kgwP0qq', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:32:26.699405', '2023-01-27 03:32:26.699405')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:32:27 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "GB1JPeFsDg9jPYCBwwYHsUbB"], ["updated_at", "2023-01-27 03:32:27.270565"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2430)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:32:27 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "GB1JPeFsDg9jPYCBwwYHsUbB"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 03:32:27.293612"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1292)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:33:11.991793', '2023-01-27 03:33:11.991793'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:33:11.991793', '2023-01-27 03:33:11.991793'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:33:11.991793', '2023-01-27 03:33:11.991793');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$QPXnz.JZcPAxW0s20M6MPukt9.R4TCQWVRTLtuAfJoUlZ1rI5l3rS', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:33:11.995983', '2023-01-27 03:33:11.995983'), (135138680, 'admin', '$2a$04$B5RQJm8CgoqbMHwkQO.ZE.Dfg5RXnH3Hhel3qcl2Fhuth2gV8rGUa', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:33:11.995983', '2023-01-27 03:33:11.995983'), (369520569, 'stocker1', '$2a$04$z4Dqzzc59Jv4NZ4uiPpjcu0ZYdEzvV9Sf5IQlrTtcL6vIkmaBg/mS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:33:11.995983', '2023-01-27 03:33:11.995983'), (252657165, 'stocker2', '$2a$04$1447/iBa41Oa.GdJm61U2equGhm0ANmGjuIYsUZ1/OFWMAi4u2hau', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:33:11.995983', '2023-01-27 03:33:11.995983')[0m
  [1m[36mTRANSACTION (25.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:33:12 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "oduqukWpfoZYTu9pbcECJW6X"], ["updated_at", "2023-01-27 03:33:12.589150"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2429)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:33:12 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "oduqukWpfoZYTu9pbcECJW6X"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 03:33:12.612104"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1292)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:35:54.033205', '2023-01-27 03:35:54.033205'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:35:54.033205', '2023-01-27 03:35:54.033205'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:35:54.033205', '2023-01-27 03:35:54.033205');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$x0g3dP5dRvLLZ0SinzMKoOjI43uks3JHMgjZ9OAkxsD2tRn3qSCni', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:35:54.037670', '2023-01-27 03:35:54.037670'), (135138680, 'admin', '$2a$04$ZHz9pfX.MB0hXNvd35GYlOZ4guoM9tfdRxtTP7Dp2a/jrLnIMzzEW', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:35:54.037670', '2023-01-27 03:35:54.037670'), (369520569, 'stocker1', '$2a$04$BGZ7HdBOKUgnFyn3vz.zBet16W/EQaiXVsMlw8YQab1hHNuzbLqg2', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:35:54.037670', '2023-01-27 03:35:54.037670'), (252657165, 'stocker2', '$2a$04$/IKd0vRmw2eT9kwb79w1RuIY3YMpGwNKuTpLQQXah2QliSn79sZOK', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:35:54.037670', '2023-01-27 03:35:54.037670')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:35:54 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "YrEupu5ssoPzHnKxgmFR5MSy"], ["updated_at", "2023-01-27 03:35:54.601934"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:35:54 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "YrEupu5ssoPzHnKxgmFR5MSy"], ["LIMIT", 1]]
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2286)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:36:10.167538', '2023-01-27 03:36:10.167538'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:36:10.167538', '2023-01-27 03:36:10.167538'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:36:10.167538', '2023-01-27 03:36:10.167538');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$k9Q.C4VHyBt4TPOK9ft0POxM7YXuwmGYf64hBHrJM0MLfExXTxk/.', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:36:10.172371', '2023-01-27 03:36:10.172371'), (135138680, 'admin', '$2a$04$M9DsjbEdnBh1JzrSYQVLg.9OIIPcMVH1iG5f5sEX9suv8.5k/FOh6', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:36:10.172371', '2023-01-27 03:36:10.172371'), (369520569, 'stocker1', '$2a$04$TUG5S.4AaEs7PZqjlhNv/.GlwTJGExSE8lb8PnqMirC4hqYwtLv3K', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:36:10.172371', '2023-01-27 03:36:10.172371'), (252657165, 'stocker2', '$2a$04$HCfs2jxN9GfkrAPIKC97sew9arhJcoPTn8iUKOG5BD5T1xKueG7Ea', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:36:10.172371', '2023-01-27 03:36:10.172371')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:36:10 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "FGutxZtWPwnQ35ZPxC7cizvE"], ["updated_at", "2023-01-27 03:36:10.747031"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2430)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:36:10 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "FGutxZtWPwnQ35ZPxC7cizvE"], ["LIMIT", 1]]
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2286)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:36:25.122523', '2023-01-27 03:36:25.122523'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:36:25.122523', '2023-01-27 03:36:25.122523'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:36:25.122523', '2023-01-27 03:36:25.122523');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$lU9vPj.KnakW11mAI2N6qeZx6zWBixeNwppT4jc7Bms1if7nn93wG', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:36:25.127427', '2023-01-27 03:36:25.127427'), (135138680, 'admin', '$2a$04$p18F4DCXALmsaCfg6q8u4ulwbv49sgd6HgKKOW3oh5M8MaFQrV0m.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:36:25.127427', '2023-01-27 03:36:25.127427'), (369520569, 'stocker1', '$2a$04$oMegZ5ucrdnTY9DlxSnA.OVS4XE8sXNqCe43FHXmAAq9ywkXBRWSW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:36:25.127427', '2023-01-27 03:36:25.127427'), (252657165, 'stocker2', '$2a$04$/bS27edhCD/FO0fuJu7KeOnMym.sUCTkS5BQZfZr4aCInYuNdgI6i', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:36:25.127427', '2023-01-27 03:36:25.127427')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:36:25 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "qPXECLdqNXQsLXVQHQNveC5S"], ["updated_at", "2023-01-27 03:36:25.692606"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2392)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:36:25 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "qPXECLdqNXQsLXVQHQNveC5S"], ["LIMIT", 1]]
Completed 400 Bad Request in 5ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 2286)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:37:54.288240', '2023-01-27 03:37:54.288240'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:37:54.288240', '2023-01-27 03:37:54.288240'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:37:54.288240', '2023-01-27 03:37:54.288240');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$g8wKZSdDmdQhbGJMPbS10.jYw5df88qyb8PTe6Wt9rFW0kC0t9X62', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:37:54.292356', '2023-01-27 03:37:54.292356'), (135138680, 'admin', '$2a$04$h5nljI0pMurbKLJPh3vmX.Z51vBEdag66yX3mImIdhsiUzlLb3rsi', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:37:54.292356', '2023-01-27 03:37:54.292356'), (369520569, 'stocker1', '$2a$04$dG7Pxn00QR.cBSlXPhk9meF6MoE.qzOc87JgLH57XW.JXzFg9MV3G', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:37:54.292356', '2023-01-27 03:37:54.292356'), (252657165, 'stocker2', '$2a$04$4E/xrIEbT1LDUOiKGsJgle/AtobnBNHZfqTQ8MogkdLh2Km.VHTNe', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:37:54.292356', '2023-01-27 03:37:54.292356')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:37:54 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "meaiuif3idGWBaFGtBKBjWgY"], ["updated_at", "2023-01-27 03:37:54.863699"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2432)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 03:37:54 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "meaiuif3idGWBaFGtBKBjWgY"], ["LIMIT", 1]]
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2286)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:47:34.419915', '2023-01-27 03:47:34.419915'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:47:34.419915', '2023-01-27 03:47:34.419915'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:47:34.419915', '2023-01-27 03:47:34.419915');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$lDCXDmnDe1NBuzM.l7TOM.VM4sEYq0tl7jd/IdJjlRssz8z038mBm', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:47:34.424307', '2023-01-27 03:47:34.424307'), (135138680, 'admin', '$2a$04$JyV.g5ueNKC2q.Nb2vLXRuirhHXDk5NQr4Ai9ipiI/.19vO718Jdm', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:47:34.424307', '2023-01-27 03:47:34.424307'), (369520569, 'stocker1', '$2a$04$29eErgPTz1PUsax5NUuM8ebHf6zNQtv3KacYqgFB/lvYUvt/RQP.6', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:47:34.424307', '2023-01-27 03:47:34.424307'), (252657165, 'stocker2', '$2a$04$jBA58ddKpSpN8U1rMUhomelnGEK/W707c7bAovCerWHce2S86sz.W', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:47:34.424307', '2023-01-27 03:47:34.424307')[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
SessionsControllerTest: test_should_login
-----------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:47:34 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "nj2eFgA9mFhj5ebZkNynbDtm"], ["updated_at", "2023-01-27 03:47:35.004002"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2430)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 03:47:40.166423', '2023-01-27 03:47:40.166423'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 03:47:40.166423', '2023-01-27 03:47:40.166423'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 03:47:40.166423', '2023-01-27 03:47:40.166423');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$2QAzV7G21lcLiYkD8/eofeet6UYJZ0HzjvOjLu/JLnfyqBc4iUYw.', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 03:47:40.170522', '2023-01-27 03:47:40.170522'), (135138680, 'admin', '$2a$04$nFpqN6BYcHEjCRUlzIU6Ueaqax2UY0ZO/xPOhh4f5AoDS.tom4dCu', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 03:47:40.170522', '2023-01-27 03:47:40.170522'), (369520569, 'stocker1', '$2a$04$M.nehHxiITEHrLBjmgYJ3eIa0hgcSBCXXs6Yg2TeESqYy3Z43TJD.', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 03:47:40.170522', '2023-01-27 03:47:40.170522'), (252657165, 'stocker2', '$2a$04$ms6soWTYQ6q3DGR/t4a.4ueUfH0aOpzJ45GM.SM.kWeRrguHMpvq.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 03:47:40.170522', '2023-01-27 03:47:40.170522')[0m
  [1m[36mTRANSACTION (40.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
SessionsControllerTest: test_should_not_login
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 03:47:40 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
Completed 401 Unauthorized in 5ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 2524)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:00:31.216546', '2023-01-27 04:00:31.216546'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:00:31.216546', '2023-01-27 04:00:31.216546'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:00:31.216546', '2023-01-27 04:00:31.216546');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$qU/n2rBKuy6JiR9qFk67sOD0TO2kvB5BV3293wi58WX6AygZtY0lS', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:00:31.221262', '2023-01-27 04:00:31.221262'), (135138680, 'admin', '$2a$04$./8ifNInVxBSvsrung2adOeX4Rh5jweAkVT8g7PdmeQ/qgKU6T7qG', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:00:31.221262', '2023-01-27 04:00:31.221262'), (369520569, 'stocker1', '$2a$04$i7eOdAo08weQ.LYUP6axEO839h30SfMCuMVgVNRs3.8Sfy.HKJ38e', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:00:31.221262', '2023-01-27 04:00:31.221262'), (252657165, 'stocker2', '$2a$04$j4z7PcxBp1Rw8qd8HaRvs.6GWtJPUgcRk18iNO3p2jrTRUVjop8Ni', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:00:31.221262', '2023-01-27 04:00:31.221262')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login
-------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:00:31 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "rpokXbv7FJYVGmRNWKJ6vYkG"], ["created_at", "2023-01-27 04:00:31.824798"], ["updated_at", "2023-01-27 04:00:31.824798"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 6950)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:00:42.573826', '2023-01-27 04:00:42.573826'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:00:42.573826', '2023-01-27 04:00:42.573826'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:00:42.573826', '2023-01-27 04:00:42.573826');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$QWNFL4MOpa2hXcaa/7rIr.yrJFuBz1wE61qvm3deTwyMcTONhpJt2', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:00:42.578934', '2023-01-27 04:00:42.578934'), (135138680, 'admin', '$2a$04$CfgspxwEv/1gE6hoMFLRluDX28Rwt3pIU2A3WSkgu.PK5pV42pIFm', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:00:42.578934', '2023-01-27 04:00:42.578934'), (369520569, 'stocker1', '$2a$04$3Ui1wqXhynDzRe.IScYeZuFAUJWTlmpX/xg5c1w63345r/fzNMzvK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:00:42.578934', '2023-01-27 04:00:42.578934'), (252657165, 'stocker2', '$2a$04$H3va68ZYlD2LQaFZIo0/U.5Fj/eHNCf9RFzCaNkqcP8Ct8eTx6tMG', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:00:42.578934', '2023-01-27 04:00:42.578934')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login
-------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:00:42 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "PKKUXoEiz5Gpp9bJGzetk5U5"], ["created_at", "2023-01-27 04:00:43.196484"], ["updated_at", "2023-01-27 04:00:43.196484"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 6950)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:00:43 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:00:43 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "M8cMsT4dAPaTbYw1AEHSkfpt"], ["updated_at", "2023-01-27 04:00:43.230858"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1132)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:01:02.467518', '2023-01-27 04:01:02.467518'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:01:02.467518', '2023-01-27 04:01:02.467518'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:01:02.467518', '2023-01-27 04:01:02.467518');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$6W1woKs5eTjo8qjmmKlM9emuLldCiEpU1GWu8IrvzOw6ZHPmq0l6m', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:01:02.472173', '2023-01-27 04:01:02.472173'), (135138680, 'admin', '$2a$04$XO9BCYRuV4.apEuBoPb9kegKsk3LhlShVGDsOjIvg7xAfouo/Rwvu', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:01:02.472173', '2023-01-27 04:01:02.472173'), (369520569, 'stocker1', '$2a$04$a1ADiVugSfSVtbW56Pt8NuDFZbvNEVBL4xfJ1jxEKmFUXfdKpNfuK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:01:02.472173', '2023-01-27 04:01:02.472173'), (252657165, 'stocker2', '$2a$04$205KRcNG1Wa23S.EZE2XEOMKZhKZMAAytPSp12Y9W7UbbSF7ldHx2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:01:02.472173', '2023-01-27 04:01:02.472173')[0m
  [1m[36mTRANSACTION (86.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:01:02 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "E4XQ9ETmShspNPbMPme4qiDL"], ["updated_at", "2023-01-27 04:01:03.131248"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2431)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:02:25.951538', '2023-01-27 04:02:25.951538'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:02:25.951538', '2023-01-27 04:02:25.951538'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:02:25.951538', '2023-01-27 04:02:25.951538');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$phdbpbqmEeaI.ZWln8622.n5WTs7DNAur6.Z3h07wQs7vRl0SDZKq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:02:25.955836', '2023-01-27 04:02:25.955836'), (135138680, 'admin', '$2a$04$gdDXgqvEAusPKx.ECUNHFeqPD3uW9Th3nkcW.tV/V0irlYYjNPA5G', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:02:25.955836', '2023-01-27 04:02:25.955836'), (369520569, 'stocker1', '$2a$04$BWvrV5IMbkw5UcREmXiPkubOhImoZj2ORVAaaOTzJn7mEFhfUZ7pe', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:02:25.955836', '2023-01-27 04:02:25.955836'), (252657165, 'stocker2', '$2a$04$WUgnvZIYJxahdBDtNSRuVedmVVwJtidpj.d6NTCwSMaREyvyqPPFO', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:02:25.955836', '2023-01-27 04:02:25.955836')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:02:26 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "URTUxENgEikBmwxwywV5cCQV"], ["updated_at", "2023-01-27 04:02:26.526980"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2432)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (2.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.4ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.6ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:04:17.712475', '2023-01-27 04:04:17.712475'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:04:17.712475', '2023-01-27 04:04:17.712475'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:04:17.712475', '2023-01-27 04:04:17.712475');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$372wUBgICljfwSeg7vJ6e.0794YBuCaxko9idkSRr2.Gf.jdVoIsS', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:04:17.720744', '2023-01-27 04:04:17.720744'), (135138680, 'admin', '$2a$04$iYeKdE1MsbPVesSPjbZ38uCtGpN7VzdVas0FC0PMtGONwYei7YwI2', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:04:17.720744', '2023-01-27 04:04:17.720744'), (369520569, 'stocker1', '$2a$04$uyjhJTBMPagU3hTV.VfWKO/4gw.tUZfJ6tnuWxDH20/zDwrndSCL2', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:04:17.720744', '2023-01-27 04:04:17.720744'), (252657165, 'stocker2', '$2a$04$oAi3ceDarGAHfyWXgHQuPusGoZbhvMofDPALTA30.hV31cyZigAaq', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:04:17.720744', '2023-01-27 04:04:17.720744')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:04:18 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "rZiNxqy1a9G5nvcZBPvZkAB2"], ["updated_at", "2023-01-27 04:04:18.344854"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2425)
Started PUT "/users" for 127.0.0.1 at 2023-01-27 04:04:18 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:05:04.038308', '2023-01-27 04:05:04.038308'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:05:04.038308', '2023-01-27 04:05:04.038308'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:05:04.038308', '2023-01-27 04:05:04.038308');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$lA8JuPr4y1uZp8rkmH.uuu5e8lnZgYdz6tLKLTP/FSbsqMMnvobHm', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:05:04.042523', '2023-01-27 04:05:04.042523'), (135138680, 'admin', '$2a$04$d4OyZmn8MOnWkJIvCBy9u.acmReFX7hlgPS2z1VGGT8iRNrIL8Amq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:05:04.042523', '2023-01-27 04:05:04.042523'), (369520569, 'stocker1', '$2a$04$QIpVsu6qLVb3IdZvRmKYauhTnCIB32jWaqZeRlLktgXH/lfyYIXHy', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:05:04.042523', '2023-01-27 04:05:04.042523'), (252657165, 'stocker2', '$2a$04$4MkaEpar7uHFiszRzb2zBufSnA6NU2EEfrGF9C1p0wbtS1DsDLczS', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:05:04.042523', '2023-01-27 04:05:04.042523')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:05:04 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "tpG26w7nFnSFFBwPCoMaajbQ"], ["updated_at", "2023-01-27 04:05:04.642498"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2431)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:06:24.433967', '2023-01-27 04:06:24.433967'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:06:24.433967', '2023-01-27 04:06:24.433967'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:06:24.433967', '2023-01-27 04:06:24.433967');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$Ujc0B2IGHYLF12xjZCoaK.g2B2pGX25T2FbjaMtGKx6fTQ4oWRGba', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:06:24.438745', '2023-01-27 04:06:24.438745'), (135138680, 'admin', '$2a$04$3Oty5pWf1UytEa.nDr1noO/PVL6nq4uq/E1/CWMbBIyR.qKA1H6ya', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:06:24.438745', '2023-01-27 04:06:24.438745'), (369520569, 'stocker1', '$2a$04$CXJzFmSh3b/gli8sJchoCef8Hxzu10z3agjX4.V5WV8Yt0LRAAadC', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:06:24.438745', '2023-01-27 04:06:24.438745'), (252657165, 'stocker2', '$2a$04$Yy4htbOFfe2Epwi/ZeALwuD8C26SeFefPqTCKSzL7.s10u2kt9CSS', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:06:24.438745', '2023-01-27 04:06:24.438745')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:06:24 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "3hkcDDvjsKSTC2xcrpsEaixv"], ["updated_at", "2023-01-27 04:06:24.984262"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2438)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:06:29 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "3hkcDDvjsKSTC2xcrpsEaixv"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:06:29.398181"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2722)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:06:40.740906', '2023-01-27 04:06:40.740906'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:06:40.740906', '2023-01-27 04:06:40.740906'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:06:40.740906', '2023-01-27 04:06:40.740906');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$LRjW2KrrlVuKL8iYDbnKceMdNO6mNjh8CrTjLo2cVHzOPkujG7jGy', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:06:40.745129', '2023-01-27 04:06:40.745129'), (135138680, 'admin', '$2a$04$yvejP.n8L/41k8AL5cmhXugvIy3BH2DfxkOeimWoDqkvvZHsGji5.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:06:40.745129', '2023-01-27 04:06:40.745129'), (369520569, 'stocker1', '$2a$04$gfMRXf5fDhGRfiFtEx9nG.iTuqMYzRMiW/oZ/dBu/EX2CcXIaBqWq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:06:40.745129', '2023-01-27 04:06:40.745129'), (252657165, 'stocker2', '$2a$04$CNuRRxGCIds.aBhSdCkkIejq5qM4FZZZyLt3rSK9OT4lPtQWI/Cwu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:06:40.745129', '2023-01-27 04:06:40.745129')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:06:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Xf5frdq6CZFFF9Xe3GQYWFED"], ["updated_at", "2023-01-27 04:06:41.284475"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 2438)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:06:41 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Xf5frdq6CZFFF9Xe3GQYWFED"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 8ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 3673)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:07:01.226325', '2023-01-27 04:07:01.226325'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:07:01.226325', '2023-01-27 04:07:01.226325'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:07:01.226325', '2023-01-27 04:07:01.226325');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$xoUbH.XdE0E19p9cWHFyK.k9DX519YWqbxjMpP1UvjMzI3rb4/rhC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:07:01.230577', '2023-01-27 04:07:01.230577'), (135138680, 'admin', '$2a$04$aJDWDEAAV/wQuVUqEAZTPOsnEZ.KzNuPiHtS7EApXMJuWuo9uGUB.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:07:01.230577', '2023-01-27 04:07:01.230577'), (369520569, 'stocker1', '$2a$04$QxPGfRygClP6yv5z2VpmXexTleZQwfMzv2TJiKUjPs/o/TkfBGaGy', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:07:01.230577', '2023-01-27 04:07:01.230577'), (252657165, 'stocker2', '$2a$04$HcxThh1v1xXTW3xeBsIN9.BDMV8E21vEF5YhWDcqTK7u0.vAB/jkm', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:07:01.230577', '2023-01-27 04:07:01.230577')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:07:01 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "N1Ah19dRje3Mgq2NczYkLVcu"], ["updated_at", "2023-01-27 04:07:01.768066"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2438)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:07:01 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "N1Ah19dRje3Mgq2NczYkLVcu"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 7ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 3673)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:08:38.165259', '2023-01-27 04:08:38.165259'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:08:38.165259', '2023-01-27 04:08:38.165259'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:08:38.165259', '2023-01-27 04:08:38.165259');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$gzwQq0GeYEtEIgM8dlKEdeE.GSlBovSF/X7OosXrNNhKotxtm2lCq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:08:38.169405', '2023-01-27 04:08:38.169405'), (135138680, 'admin', '$2a$04$TcnuZQTqD.f/YM7LoL7iu.pyablxUuHSrfjzulD2vSOxkLfNQj9Ty', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:08:38.169405', '2023-01-27 04:08:38.169405'), (369520569, 'stocker1', '$2a$04$y5xwCN7P18vzhFEVcXpj/Od2OQA6EG0YNC2cpGArpaiVJnYPkV4ti', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:08:38.169405', '2023-01-27 04:08:38.169405'), (252657165, 'stocker2', '$2a$04$3ZKmzcj4ZMh8x74C8pPwn.QAHxwlIl9dawEruwKQWIcWWU2/Lxj1y', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:08:38.169405', '2023-01-27 04:08:38.169405')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:08:38 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "JEaV7VmpZtS5m8BrqiKF8V3D"], ["updated_at", "2023-01-27 04:08:38.715192"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2436)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:08:38 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "JEaV7VmpZtS5m8BrqiKF8V3D"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1016)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:09:02.739782', '2023-01-27 04:09:02.739782'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:09:02.739782', '2023-01-27 04:09:02.739782'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:09:02.739782', '2023-01-27 04:09:02.739782');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$1xLLpXg8O947sW0aejD4ie/7VR1aoMNh61HONORizLj5CjHkcB8Ca', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:09:02.743946', '2023-01-27 04:09:02.743946'), (135138680, 'admin', '$2a$04$lymPOo515KIfJEvh56cRNelbS2WzcjbGD66NG6OnK9GKL.irxy966', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:09:02.743946', '2023-01-27 04:09:02.743946'), (369520569, 'stocker1', '$2a$04$/grsCaPHyy/4mA.tut5bKOmGR1o9ojXOnlV5dXoakpFTTLaAjaz0G', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:09:02.743946', '2023-01-27 04:09:02.743946'), (252657165, 'stocker2', '$2a$04$HPJdtV3P6kGbpVgRoJjfy.iDzMmRJxaeEe2FeyvhWGvjpA/1Nx286', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:09:02.743946', '2023-01-27 04:09:02.743946')[0m
  [1m[36mTRANSACTION (9.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:09:03 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "XfBjBmzXtMMpYRpKoi8mEw6u"], ["updated_at", "2023-01-27 04:09:03.300943"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2437)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:09:03 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "XfBjBmzXtMMpYRpKoi8mEw6u"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1016)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:09:28.233314', '2023-01-27 04:09:28.233314'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:09:28.233314', '2023-01-27 04:09:28.233314'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:09:28.233314', '2023-01-27 04:09:28.233314');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$z2BN15vkiLht4gjeChjVRuebUdkWwpOlbOf6oRofTM6r3OTavOqNS', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:09:28.237449', '2023-01-27 04:09:28.237449'), (135138680, 'admin', '$2a$04$SoWZbKnixWjXGg937C7nfuuMSSoHDErg/iJ9K3N79CQd0izt3H.5a', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:09:28.237449', '2023-01-27 04:09:28.237449'), (369520569, 'stocker1', '$2a$04$pC/AKx.raqIYWwATJKJJJ.Zt5P.TNbk9iYEGBihG3Neg9LXmdkP7O', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:09:28.237449', '2023-01-27 04:09:28.237449'), (252657165, 'stocker2', '$2a$04$HmdsylJGXruI97reO01pde3hx80d1.MtoEHzg3BFxaUODVUVNqFje', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:09:28.237449', '2023-01-27 04:09:28.237449')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:09:28 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "F8V549HPDDBUnLZP45o6C8e3"], ["updated_at", "2023-01-27 04:09:28.797167"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:09:28 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "F8V549HPDDBUnLZP45o6C8e3"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1016)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:11:03.951851', '2023-01-27 04:11:03.951851'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:11:03.951851', '2023-01-27 04:11:03.951851'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:11:03.951851', '2023-01-27 04:11:03.951851');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$KIL0fVED0xzMFVxJwBQ0Zue/miyIPyfqOCmRrskm1cq7gxlLgMfgm', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:11:03.956035', '2023-01-27 04:11:03.956035'), (135138680, 'admin', '$2a$04$Sg8YCWRMkxZv3aHiQRWTpe0HWgWRjoeElr8qqY.pqpUcBiDpXWzQm', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:11:03.956035', '2023-01-27 04:11:03.956035'), (369520569, 'stocker1', '$2a$04$uOAIDwa1cJEUK4vx0d8oNerjSV1YGOIiVfy9EU00Ej.MhGMAEnolq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:11:03.956035', '2023-01-27 04:11:03.956035'), (252657165, 'stocker2', '$2a$04$C4zujg7WgIZqvcoSd8h/qepU8sOQVz06yqUGD4kO5Px0wP2psAkw2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:11:03.956035', '2023-01-27 04:11:03.956035')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:11:04 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "D457nHPmgWVWaPpdS5jjCVL8"], ["updated_at", "2023-01-27 04:11:04.487361"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2436)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:11:04 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "D457nHPmgWVWaPpdS5jjCVL8"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 490)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:15:05.597544', '2023-01-27 04:15:05.597544'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:15:05.597544', '2023-01-27 04:15:05.597544'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:15:05.597544', '2023-01-27 04:15:05.597544');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$PxMxP/uZRQXMA0wCO2aTH.qbB5XdnP88uCQRa1ZfYdpiS0B3nJxze', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:15:05.601968', '2023-01-27 04:15:05.601968'), (135138680, 'admin', '$2a$04$XRtnGCyarVVCPTNwWNM7bO7xWcvSgW4tJTIbuHPvtT.aQIeCO685e', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:15:05.601968', '2023-01-27 04:15:05.601968'), (369520569, 'stocker1', '$2a$04$o0vOZeAPfCiKkMBuOmiNV.Jom/EdUie/wtkipNMkT42Ean7Lj4aXK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:15:05.601968', '2023-01-27 04:15:05.601968'), (252657165, 'stocker2', '$2a$04$uXSorQtWW6X659Jm7tXXy.fycyxCE/IkE2ZiZdB8O8.9Y.pgD/Dy6', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:15:05.601968', '2023-01-27 04:15:05.601968')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:15:05 +0000
Processing by UsersController#create as JSON
  Parameters: {"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]", "user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 14ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 8801)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "a3gjLR9XRFgCX6rgGc7jS8MT"], ["updated_at", "2023-01-27 04:15:06.219201"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1681)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "a3gjLR9XRFgCX6rgGc7jS8MT"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:15:06.230914"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1198)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_specific_user
-----------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "fBemVc19Fr1LjxVAbDoXgehZ"], ["updated_at", "2023-01-27 04:15:06.242726"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 983)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "sVMPw6XwNVL6pDeduSnz64D6"], ["updated_at", "2023-01-27 04:15:06.257474"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 983)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "sVMPw6XwNVL6pDeduSnz64D6"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 232)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "tgehQRMdxgDZMjvXjauDHuga"], ["updated_at", "2023-01-27 04:15:06.307292"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 984)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "tgehQRMdxgDZMjvXjauDHuga"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1415)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "DneDSCZoXFH4fRBL29obuycd"], ["updated_at", "2023-01-27 04:15:06.330283"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 986)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "DneDSCZoXFH4fRBL29obuycd"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:15:06.340025"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1050)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "LnvBQtGBSUzLruWSX82CTYm3"], ["updated_at", "2023-01-27 04:15:06.352599"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 986)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "LnvBQtGBSUzLruWSX82CTYm3"], ["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 248)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "dvGrE7GKjdwUQ6m2eTBP96Zg"], ["updated_at", "2023-01-27 04:15:06.372492"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 990)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:15:06 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "dvGrE7GKjdwUQ6m2eTBP96Zg"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 748)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:16:00.321860', '2023-01-27 04:16:00.321860'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:16:00.321860', '2023-01-27 04:16:00.321860'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:16:00.321860', '2023-01-27 04:16:00.321860');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$mn.6LaXZlJCA7tf9uepo0ObR0a6B2pNzFJxLFQJv6FKFwspgeXlVy', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:16:00.326168', '2023-01-27 04:16:00.326168'), (135138680, 'admin', '$2a$04$hX7fTHiH9oc3CdROjPRsbuZsNT1XXV6bcfswcJdLawpZmee4XAM7O', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:16:00.326168', '2023-01-27 04:16:00.326168'), (369520569, 'stocker1', '$2a$04$V2PtAZOkhRwWPvHdBupDW.4VRjNpSEJNzBeGuNQ2s483q7TuPwh/K', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:00.326168', '2023-01-27 04:16:00.326168'), (252657165, 'stocker2', '$2a$04$6042Z7G4ogVF4qHQgzvrsuNIhJU5viSkxvuYSRz6UsGXawQYqqfuO', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:00.326168', '2023-01-27 04:16:00.326168')[0m
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (13.9ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:16:00 +0000
Processing by UsersController#create as JSON
  Parameters: {"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]", "user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 14ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 8800)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:16:14.391091', '2023-01-27 04:16:14.391091'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:16:14.391091', '2023-01-27 04:16:14.391091'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:16:14.391091', '2023-01-27 04:16:14.391091');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$pe2pOHwt9utPySLHRKsRDOcJBbDLeqzhz7hf21yY20SHP6KFTc4dK', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:16:14.395495', '2023-01-27 04:16:14.395495'), (135138680, 'admin', '$2a$04$ThXd0OZ3VAU9p4QyoBoCpuN1Y3i2xn.vlnWuBVJK2TKTvQQBOOsCK', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:16:14.395495', '2023-01-27 04:16:14.395495'), (369520569, 'stocker1', '$2a$04$RrVbU0xB7YtxobukOhufT.CpIu.VDziNLaaryINvncvkYPjMIaNKq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:14.395495', '2023-01-27 04:16:14.395495'), (252657165, 'stocker2', '$2a$04$7N7fRl6LGVEoDnOPGcfNM.hyR5iR8HG8H8in7jH/84Hdg3frxX2pi', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:14.395495', '2023-01-27 04:16:14.395495')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:16:14 +0000
Processing by UsersController#create as JSON
  Parameters: {"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]", "user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 14ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 8800)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:16:32.486132', '2023-01-27 04:16:32.486132'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:16:32.486132', '2023-01-27 04:16:32.486132'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:16:32.486132', '2023-01-27 04:16:32.486132');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$PhCLWgE1AK2KMeip/p83TezuMdiUYpIpvQ1QV4U0rqzMjpseKNlrm', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:16:32.490573', '2023-01-27 04:16:32.490573'), (135138680, 'admin', '$2a$04$YAOQKo1lGpRPQF/uBzF37O9dHMsTGzdO62CqDCdS8DWltt18sUefC', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:16:32.490573', '2023-01-27 04:16:32.490573'), (369520569, 'stocker1', '$2a$04$wJC0CdL9l7Tv/zdP5g3Jgu21qsct9.LC3stqz0Vo0wVrRbE948er.', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:32.490573', '2023-01-27 04:16:32.490573'), (252657165, 'stocker2', '$2a$04$cgG9qwUdbDSzuQTiVY0tKOZCe3m1Iau1nZwHg/0oreuOsQqwfmXyu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:16:32.490573', '2023-01-27 04:16:32.490573')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:16:51 +0000
Processing by UsersController#create as JSON
  Parameters: {"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]", "user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 14ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 9376)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:17:41.529137', '2023-01-27 04:17:41.529137'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:17:41.529137', '2023-01-27 04:17:41.529137'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:17:41.529137', '2023-01-27 04:17:41.529137');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$Vn1RHaEL3e5hzrNLqJf2Kupgk4ucavv0iOANokyP7Km9DqSI309AK', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:17:41.533490', '2023-01-27 04:17:41.533490'), (135138680, 'admin', '$2a$04$NMzzXuYpG1gR/ItewREjCejOZuIf7Qntu8NbDOAyOi70tQc2Kja2O', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:17:41.533490', '2023-01-27 04:17:41.533490'), (369520569, 'stocker1', '$2a$04$EYb3MB5vbY5oq3xZQoMp4OsBszBkFmkEg04nB4Ni3lTCAZQYdukAq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:17:41.533490', '2023-01-27 04:17:41.533490'), (252657165, 'stocker2', '$2a$04$1mQkTv0uYLK6LhgF8UMX4uXi6fDG0B2ufXn.1pfGE//PlzhW34SfO', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:17:41.533490', '2023-01-27 04:17:41.533490')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:17:41 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "VLg8XQ22YkwVvZojYxd1ZzR2"], ["created_at", "2023-01-27 04:17:42.067412"], ["updated_at", "2023-01-27 04:17:42.067412"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 6958)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:17:42 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:17:42 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "MKYnuy1SY2swfnCL6uoTaKFm"], ["updated_at", "2023-01-27 04:17:42.100373"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1116)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:17:42 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "MKYnuy1SY2swfnCL6uoTaKFm"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 396)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:19:09.618398', '2023-01-27 04:19:09.618398'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:19:09.618398', '2023-01-27 04:19:09.618398'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:19:09.618398', '2023-01-27 04:19:09.618398');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$gWsgcSnLNlgXKaC4GT1r5uc2XzgmuOelJz39Qv9Pigi4tQxJUC7ia', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:19:09.622671', '2023-01-27 04:19:09.622671'), (135138680, 'admin', '$2a$04$NM50T4jPROfZcz1VKs8mXO8fJ7nel8emvvA3ZMNN3jWoqq4lZ6MKy', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:19:09.622671', '2023-01-27 04:19:09.622671'), (369520569, 'stocker1', '$2a$04$//bSHxOM8NRhEjFfy4JftO.8BEaPeE7DQk1CyZyhMUGjD1jHFnzBW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:09.622671', '2023-01-27 04:19:09.622671'), (252657165, 'stocker2', '$2a$04$3W0mc6dL/zkoqWU83bkop.BedFJGJ.szcwQ79jR/uCsJJmBdmt2Lu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:09.622671', '2023-01-27 04:19:09.622671')[0m
  [1m[36mTRANSACTION (15.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:19:09 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "Ynf5y1weJPxsXgXAyNSpZxmk"], ["created_at", "2023-01-27 04:19:10.188804"], ["updated_at", "2023-01-27 04:19:10.188804"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.4ms | ActiveRecord: 0.9ms | Allocations: 6957)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:19:10 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:19:10 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "vyT5dBadNSrmNVxbB3ZsmGPm"], ["updated_at", "2023-01-27 04:19:10.221429"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1114)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:19:10 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "vyT5dBadNSrmNVxbB3ZsmGPm"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 396)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:19:28.553868', '2023-01-27 04:19:28.553868'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:19:28.553868', '2023-01-27 04:19:28.553868'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:19:28.553868', '2023-01-27 04:19:28.553868');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$nlqrQlhkgkdtuWDyyVeCceGWJd8uZhM8eJHhA4LtDDvbn21G.3Fme', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:19:28.558252', '2023-01-27 04:19:28.558252'), (135138680, 'admin', '$2a$04$gr3M6xdNgT9y0TWZgVzGb.ZWX7bHPaXOHRfsZcN6DK.yRQr5YzTem', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:19:28.558252', '2023-01-27 04:19:28.558252'), (369520569, 'stocker1', '$2a$04$hdWgRbOGzd0IJgZVznnoruAawr/UQPlV6woYjJ6/cwc4JnqIPZpp2', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:28.558252', '2023-01-27 04:19:28.558252'), (252657165, 'stocker2', '$2a$04$VeL85fbv4kymwWxXV9j3junNb2Kk1yTeaNWDYiaxjkupwwWtUxNRu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:28.558252', '2023-01-27 04:19:28.558252')[0m
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:19:28 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "cJgCZV4NWSqxK6SgpeXvoVq6"], ["created_at", "2023-01-27 04:19:29.127084"], ["updated_at", "2023-01-27 04:19:29.127084"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 6956)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:19:29 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:19:29 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Gg3dEa5NcqzE9ETk7cBpDaEU"], ["updated_at", "2023-01-27 04:19:29.159483"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1131)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:19:29 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Gg3dEa5NcqzE9ETk7cBpDaEU"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 396)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:19:57.952495', '2023-01-27 04:19:57.952495'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:19:57.952495', '2023-01-27 04:19:57.952495'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:19:57.952495', '2023-01-27 04:19:57.952495');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$gl4DyYewWNXfHkOqcDXLG.D7hyq9EbtkmHO/QqgOXDZneDPA2yrlC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:19:57.956758', '2023-01-27 04:19:57.956758'), (135138680, 'admin', '$2a$04$bnHAyQnJ6tgIx.CcGN4qO.9U/73ML1juk8pFUtowljzExpkv4NvP2', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:19:57.956758', '2023-01-27 04:19:57.956758'), (369520569, 'stocker1', '$2a$04$RdBKDBoXO8b61lVZxdh1Fuv1dpBSlcAZFGSqoXtb2dJIvXIU3D1tG', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:57.956758', '2023-01-27 04:19:57.956758'), (252657165, 'stocker2', '$2a$04$RqMeMhqPsFS5x.GLl9OOceDRVlBWep6EY2WfJpfgvhtAhYt6RnK7m', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:19:57.956758', '2023-01-27 04:19:57.956758')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:19:58 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "MFPKQ3eDTQ8pVGhMrRqYHEzf"], ["created_at", "2023-01-27 04:19:58.545282"], ["updated_at", "2023-01-27 04:19:58.545282"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 6950)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:19:58 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:19:58 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "SWCvuwkBkHGYtSfATLL9pRtL"], ["updated_at", "2023-01-27 04:19:58.578518"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1117)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:19:58 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "SWCvuwkBkHGYtSfATLL9pRtL"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 396)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:20:41.137745', '2023-01-27 04:20:41.137745'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:20:41.137745', '2023-01-27 04:20:41.137745'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:20:41.137745', '2023-01-27 04:20:41.137745');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$KGBIASdRNp0N.6YNYhD91.b/Net1Zf4R.jHUbrJaUicJmfbUPMg2q', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:20:41.141963', '2023-01-27 04:20:41.141963'), (135138680, 'admin', '$2a$04$tT9tFN80F0Wp.lo2INfGBuOICY7HZmXgZlztO00eKYLBSdEE6s8RC', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:20:41.141963', '2023-01-27 04:20:41.141963'), (369520569, 'stocker1', '$2a$04$/zK.mytKynDi8upjuQWw6uMy3PhiP5qMzWGwqgumcZPcFHtgNvApm', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:20:41.141963', '2023-01-27 04:20:41.141963'), (252657165, 'stocker2', '$2a$04$gLgRLOUp7Qhhq43IYEVxQOydWoVeEkPoEKJ1O1TLfUWbhOYXrjQe.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:20:41.141963', '2023-01-27 04:20:41.141963')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Sa96jybduw3cU1LN4E4QFC13"], ["updated_at", "2023-01-27 04:20:41.674188"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2397)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Sa96jybduw3cU1LN4E4QFC13"], ["LIMIT", 1]]
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2286)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_specific_user
-----------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "3KifT4wt2VnmBZ1J1kTMePCB"], ["updated_at", "2023-01-27 04:20:41.711049"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1007)
Started GET "/user.1" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "tnD9bZQ7a4J5MRQhUkg2Krc9"], ["updated_at", "2023-01-27 04:20:41.742686"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 970)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "tnD9bZQ7a4J5MRQhUkg2Krc9"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 755)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "ktirCNUuTMHAMFpPfWhBjrQV"], ["updated_at", "2023-01-27 04:20:41.765938"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 985)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "ktirCNUuTMHAMFpPfWhBjrQV"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1638)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "GXXWH7dFVZRdGHNYVAjs9GtH"], ["updated_at", "2023-01-27 04:20:41.788083"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 988)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "GXXWH7dFVZRdGHNYVAjs9GtH"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:20:41.798541"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 1055)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "qWCA4HoQTz8pGctazcGWFVyX"], ["updated_at", "2023-01-27 04:20:41.810544"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 988)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "qWCA4HoQTz8pGctazcGWFVyX"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 228)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "fmWjoarPPAsNL9HQpYBhspmv"], ["updated_at", "2023-01-27 04:20:41.852182"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 984)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "fmWjoarPPAsNL9HQpYBhspmv"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:20:41.861892"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 1016)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "KeNXrgbcq72cbG6znkK1h9Yt"], ["created_at", "2023-01-27 04:20:41.873348"], ["updated_at", "2023-01-27 04:20:41.873348"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1099)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 336)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "8HK8KYu7TNs6y8rL4f8cNYqU"], ["updated_at", "2023-01-27 04:20:41.892185"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 983)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:20:41 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "8HK8KYu7TNs6y8rL4f8cNYqU"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 230)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:20:59.282918', '2023-01-27 04:20:59.282918'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:20:59.282918', '2023-01-27 04:20:59.282918'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:20:59.282918', '2023-01-27 04:20:59.282918');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$UZnxP7W/k.h8EvUC5LZg0.MmpjSW51f6yKepwCSz1PB1OQcVK7Pam', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:20:59.287447', '2023-01-27 04:20:59.287447'), (135138680, 'admin', '$2a$04$lWauplsUShi4ONUQdCwhPeutLZ9GsiG5EMXdCVsgUUKo5CznkZ8ze', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:20:59.287447', '2023-01-27 04:20:59.287447'), (369520569, 'stocker1', '$2a$04$6XGO/C0dCf19kQGLIvu0qObywuH44GBZvvQAVFKwK2E.tIEjb5/Ba', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:20:59.287447', '2023-01-27 04:20:59.287447'), (252657165, 'stocker2', '$2a$04$ruX9Qcs03WfjDQvYZ/noCeNB7TvNVIIblRVr0XROn9dp01uktFccm', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:20:59.287447', '2023-01-27 04:20:59.287447')[0m
  [1m[36mTRANSACTION (117.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:59 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "azDHvck6XsWdKcMAtpatgB7a"], ["updated_at", "2023-01-27 04:20:59.937200"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2437)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:20:59 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "azDHvck6XsWdKcMAtpatgB7a"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:20:59.968276"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1371)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:20:59 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "MoPktK7Ua5F11zqUHawB2RQp"], ["created_at", "2023-01-27 04:20:59.979531"], ["updated_at", "2023-01-27 04:20:59.979531"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1119)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:20:59 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 341)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:20:59 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "gkdNrDGyZW7TDXoo52vzmNcQ"], ["updated_at", "2023-01-27 04:20:59.999887"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 983)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "gkdNrDGyZW7TDXoo52vzmNcQ"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 232)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "BDj4uJyNFFGzYP4cmxKeqWLz"], ["updated_at", "2023-01-27 04:21:00.025847"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 987)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "BDj4uJyNFFGzYP4cmxKeqWLz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:21:00.036030"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1007)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "fKmn9xMBMKcLgdWPrcj3wH9y"], ["updated_at", "2023-01-27 04:21:00.047934"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 967)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "fKmn9xMBMKcLgdWPrcj3wH9y"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 237)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "PmGEMEYXjTz1EaiLnLgCUJs6"], ["updated_at", "2023-01-27 04:21:00.090054"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 987)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "PmGEMEYXjTz1EaiLnLgCUJs6"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 7ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 3346)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "kjhpZHre2RdRUku8f3EEVo4A"], ["updated_at", "2023-01-27 04:21:00.116185"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 985)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "kjhpZHre2RdRUku8f3EEVo4A"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 748)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "gaNNQumc1CMm1dWk6GLYr4NZ"], ["updated_at", "2023-01-27 04:21:00.138783"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "gaNNQumc1CMm1dWk6GLYr4NZ"], ["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 248)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_specific_user
-----------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "r2H3UpP6n2pZofchHjpz9Zs2"], ["updated_at", "2023-01-27 04:21:00.158917"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 985)
Started GET "/users.1" for 127.0.0.1 at 2023-01-27 04:21:00 +0000
Processing by UsersController#index as */*
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "r2H3UpP6n2pZofchHjpz9Zs2"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 714)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:21:20.039282', '2023-01-27 04:21:20.039282'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:21:20.039282', '2023-01-27 04:21:20.039282'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:21:20.039282', '2023-01-27 04:21:20.039282');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$qikp3OjZUwFE7CD.4VC73OFb5uBMhkc6kEiGD4hE5tZJjHPFAwZFa', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:21:20.043696', '2023-01-27 04:21:20.043696'), (135138680, 'admin', '$2a$04$PtvY093VC2cI/IRb4sr3pexSDDS0J5jHDXvD7E.kkYF5/hkoTSY0.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:21:20.043696', '2023-01-27 04:21:20.043696'), (369520569, 'stocker1', '$2a$04$GbcgxF1HsTbpYB3l2LMLu.H4uHFIAhRKyeL59CBI7Y95DNHQOwIbC', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:21:20.043696', '2023-01-27 04:21:20.043696'), (252657165, 'stocker2', '$2a$04$KX9JYQb.2iXwa1YcIwSzJuW0OyhjWaOImZyZVkmpAXVelASRx0vYO', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:21:20.043696', '2023-01-27 04:21:20.043696')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_specific_user
-----------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "xyuPD8wBafdQGgVbnXm2oNkB"], ["updated_at", "2023-01-27 04:21:20.593520"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2441)
Started GET "/users.1" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#index as */*
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "xyuPD8wBafdQGgVbnXm2oNkB"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1014)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "zd1aAt8sKjhsxMz4RSEy7ih6"], ["created_at", "2023-01-27 04:21:20.634617"], ["updated_at", "2023-01-27 04:21:20.634617"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1179)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 341)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "E7Ytfizbeo8oUuP7wWPVWFre"], ["updated_at", "2023-01-27 04:21:20.653958"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 985)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "E7Ytfizbeo8oUuP7wWPVWFre"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 234)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "zySoH1jyRJq5Lj2knbeVjiHN"], ["updated_at", "2023-01-27 04:21:20.675322"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 983)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "zySoH1jyRJq5Lj2knbeVjiHN"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 232)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "w1xbBDwXtaW9UMTXzLGjRNmv"], ["updated_at", "2023-01-27 04:21:20.695338"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "w1xbBDwXtaW9UMTXzLGjRNmv"], ["LIMIT", 1]]
Completed 400 Bad Request in 5ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 2023)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "azPLmCYxtgZdQw8XQQe9hEGv"], ["updated_at", "2023-01-27 04:21:20.718992"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 966)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "azPLmCYxtgZdQw8XQQe9hEGv"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:21:20.729468"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1051)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "HLKMYtYkrCTyZzf8DWS4dNz7"], ["updated_at", "2023-01-27 04:21:20.742824"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 967)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "HLKMYtYkrCTyZzf8DWS4dNz7"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 716)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "5w2U6oGjkcxbjFvxFcu7k6Zk"], ["updated_at", "2023-01-27 04:21:20.765099"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 984)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "5w2U6oGjkcxbjFvxFcu7k6Zk"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:21:20.774882"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 999)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Sfs9oMyQstSxbAwk7VqkesH8"], ["updated_at", "2023-01-27 04:21:20.787983"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 984)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:21:20 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Sfs9oMyQstSxbAwk7VqkesH8"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1577)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:21:32.901243', '2023-01-27 04:21:32.901243'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:21:32.901243', '2023-01-27 04:21:32.901243'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:21:32.901243', '2023-01-27 04:21:32.901243');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$2PJ0j7t0DYvMvymy0DCYNu0ICG0dJSMTeXH2YdxHWx.Euhi5LYDnS', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:21:32.905572', '2023-01-27 04:21:32.905572'), (135138680, 'admin', '$2a$04$yGxtjwRnMkoorEgi642Ys.Ji4J9zMFPa4ak3uADg7aKmwpPBdUrE6', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:21:32.905572', '2023-01-27 04:21:32.905572'), (369520569, 'stocker1', '$2a$04$.GyVNyqJzp8iRXSWflwlKOIvTw5TLPE0yUpAbzLJvnyG8aGR4.kgK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:21:32.905572', '2023-01-27 04:21:32.905572'), (252657165, 'stocker2', '$2a$04$X4LjmxabbN3Wbp4ajcNXCek.fjbuNl91rbLBHv4dZXOLgYNxp7H8O', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:21:32.905572', '2023-01-27 04:21:32.905572')[0m
  [1m[36mTRANSACTION (135.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "9QThkVRpn5ZerKn5nAgopPB2"], ["updated_at", "2023-01-27 04:21:33.579131"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.0ms | Allocations: 2436)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "9QThkVRpn5ZerKn5nAgopPB2"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:21:33.602947"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1371)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "zyqahwxaNHweFajn9oPMiphx"], ["updated_at", "2023-01-27 04:21:33.615569"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 985)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "zyqahwxaNHweFajn9oPMiphx"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 6ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 3362)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "sMw5hAeCA5UHSc9gPdnHTSgd"], ["updated_at", "2023-01-27 04:21:33.640939"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 989)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "sMw5hAeCA5UHSc9gPdnHTSgd"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 236)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "dCpRfmZ5TJvhuoHzPMJWoefK"], ["updated_at", "2023-01-27 04:21:33.665761"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "dCpRfmZ5TJvhuoHzPMJWoefK"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:21:33.676128"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1019)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "QckuKNmEWKxDcTjMLdkzawbp"], ["updated_at", "2023-01-27 04:21:33.688602"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 985)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "QckuKNmEWKxDcTjMLdkzawbp"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 748)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_specific_user
-----------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "4ZvEtUVorLAEsDst6SQyHCMR"], ["updated_at", "2023-01-27 04:21:33.711116"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 983)
Started GET "/users.1" for 127.0.0.1 at 2023-01-27 04:21:33 +0000
Processing by UsersController#index as */*
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "4ZvEtUVorLAEsDst6SQyHCMR"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 714)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "sUcATyCSHF1rzdqnG5Wm7uSp"], ["created_at", "2023-01-27 04:21:46.910318"], ["updated_at", "2023-01-27 04:21:46.910318"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 2254)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 521)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "S329ukiyBmMVPFTwm8U6BmBH"], ["updated_at", "2023-01-27 04:21:46.930306"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 1098)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "S329ukiyBmMVPFTwm8U6BmBH"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 242)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "1Vdf9ZoLk5j8FjFgwGcNicwi"], ["updated_at", "2023-01-27 04:21:46.951386"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:21:46 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1Vdf9ZoLk5j8FjFgwGcNicwi"], ["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 289)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.9ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:25:02.423708', '2023-01-27 04:25:02.423708'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:25:02.423708', '2023-01-27 04:25:02.423708'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:25:02.423708', '2023-01-27 04:25:02.423708');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$q57ODckWgzy7mrUIq8f2EutAWyG3dt.hQFLmgoThTuChtLb5AJVUC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:25:02.427975', '2023-01-27 04:25:02.427975'), (135138680, 'admin', '$2a$04$I3kITBzVu2g7OifCzBPwYOGvNbZ.9.xsDd2djOzXfZzqdFMkI5xQu', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:25:02.427975', '2023-01-27 04:25:02.427975'), (369520569, 'stocker1', '$2a$04$EJJWqn1axz3LgEAfuQV/n.d9YDQv.SiBPKsbYJ2XRjW5caIVIctRS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:02.427975', '2023-01-27 04:25:02.427975'), (252657165, 'stocker2', '$2a$04$LguLiFohn3//uxHnKrk1zOM1KK/PX5gvUCTrGgYijs22mresiPj7i', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:02.427975', '2023-01-27 04:25:02.427975')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:25:02 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Gu9Xa7ku7MgX8EASZLKDmKP1"], ["updated_at", "2023-01-27 04:25:02.981424"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2436)
Started DELETE "/users.1" for 127.0.0.1 at 2023-01-27 04:25:02 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:25:11.010715', '2023-01-27 04:25:11.010715'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:25:11.010715', '2023-01-27 04:25:11.010715'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:25:11.010715', '2023-01-27 04:25:11.010715');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$IzvbWSmPyVg.6eEXhoSMu.VSMWCVC3rfRPA6jYprFkhNnLg8Xdh7W', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:25:11.015070', '2023-01-27 04:25:11.015070'), (135138680, 'admin', '$2a$04$0wVnKm0BGDxO9tJnp5ruIu9w9rmHYRgO88Rxe6S5yKpB/Dpx/Dvr6', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:25:11.015070', '2023-01-27 04:25:11.015070'), (369520569, 'stocker1', '$2a$04$AjhvBSy404gLNxltcB0f2OrFiURwe/MGbtqjMZYMvNth/iR0hEjlK', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:11.015070', '2023-01-27 04:25:11.015070'), (252657165, 'stocker2', '$2a$04$wmJjm.ErzSHeuA8ZpJp3fu/SnKUvMaZLDKfdJv3g7Fk05aw8n1StG', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:11.015070', '2023-01-27 04:25:11.015070')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:25:11 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "sKnfNLsZ9gNAP4jnrb2X1DsN"], ["updated_at", "2023-01-27 04:25:11.559969"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2436)
Started DELETE "/user.1" for 127.0.0.1 at 2023-01-27 04:25:11 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:25:23.833505', '2023-01-27 04:25:23.833505'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:25:23.833505', '2023-01-27 04:25:23.833505'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:25:23.833505', '2023-01-27 04:25:23.833505');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$HbYipHlrxmRkHdeojLa8a.j9JQl8U0xlHTsRfsFm69JtrxggLQbIO', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:25:23.837591', '2023-01-27 04:25:23.837591'), (135138680, 'admin', '$2a$04$J3EKOzonaTKNh/H5Bc/.subRrLHIP3dRvVrsG0UvAW9FolFX8uFgm', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:25:23.837591', '2023-01-27 04:25:23.837591'), (369520569, 'stocker1', '$2a$04$fcZfPYDCgSmpQiOxeB9PpewgUA5AhFc6u/VBc5bVceFEO6wmg6b3m', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:23.837591', '2023-01-27 04:25:23.837591'), (252657165, 'stocker2', '$2a$04$/ikFUQOOQKCu4e8.wRxl/e1EWE8vCMHWrxtFlZ1i8LY67zjsbfaVi', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:23.837591', '2023-01-27 04:25:23.837591')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:25:24 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "qpkEVBAhRkFzscE5rps1ctfv"], ["updated_at", "2023-01-27 04:25:24.375165"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2396)
Started DELETE "/user?id=1" for 127.0.0.1 at 2023-01-27 04:25:24 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:25:54.506406', '2023-01-27 04:25:54.506406'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:25:54.506406', '2023-01-27 04:25:54.506406'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:25:54.506406', '2023-01-27 04:25:54.506406');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$Oyw.NV39AEd9xJXfCeHDxe/2yOO6hQnyn37EmrfXr2f3hFQ0ZTzz2', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:25:54.510665', '2023-01-27 04:25:54.510665'), (135138680, 'admin', '$2a$04$3MvpqwOmmKp60ZAHEKWBw.QDpnYVutP3WHj7AMeZYYFGjE34b572i', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:25:54.510665', '2023-01-27 04:25:54.510665'), (369520569, 'stocker1', '$2a$04$qnMUpeYM4Nwj7RvISsUQwuaoQD715LdkL/u95xcNmxO1mNEs4KJjW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:54.510665', '2023-01-27 04:25:54.510665'), (252657165, 'stocker2', '$2a$04$tKgkNgc5fr3R/HK/NNdGuOzycPavwlVsvh27VAv0To79VE7mXPFbS', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:25:54.510665', '2023-01-27 04:25:54.510665')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:25:54 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "CckmHf6fB1kWzaThFTv1jWa7"], ["updated_at", "2023-01-27 04:25:55.051298"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2438)
Started DELETE "/users?id=1" for 127.0.0.1 at 2023-01-27 04:25:55 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:26:15.031703', '2023-01-27 04:26:15.031703'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:26:15.031703', '2023-01-27 04:26:15.031703'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:26:15.031703', '2023-01-27 04:26:15.031703');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$8VCEZ5ityo.fjYBItfyNZOCl0y6/hUfELxouttmv.ExbAnG74Ykzq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:26:15.035938', '2023-01-27 04:26:15.035938'), (135138680, 'admin', '$2a$04$ipB4PIiZFEBDe7CjMMB/ruqXom3GUojLyfi2742MchbDjDBxUVjcq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:26:15.035938', '2023-01-27 04:26:15.035938'), (369520569, 'stocker1', '$2a$04$8vcT9V0wDO54kGz0x59S8u9yGuJ/WK86i/rGMu9yiMDcL6dDBRT8q', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:26:15.035938', '2023-01-27 04:26:15.035938'), (252657165, 'stocker2', '$2a$04$VO0pkhrinu2VibGkq674EuRFhPg.b6KoVI/Rw.xlix4mFwPMkTb3m', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:26:15.035938', '2023-01-27 04:26:15.035938')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:26:15 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "AjTbHNAKPLDTeMGPpKV7Kq68"], ["updated_at", "2023-01-27 04:26:15.573533"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2440)
Started DELETE "/users.1" for 127.0.0.1 at 2023-01-27 04:26:15 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:27:48.517464', '2023-01-27 04:27:48.517464'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:27:48.517464', '2023-01-27 04:27:48.517464'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:27:48.517464', '2023-01-27 04:27:48.517464');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$TZTOB77300Nx20GENGNqSeaAxVemSQ5Qvr9s1FBTdjqqZZeum1.5a', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:27:48.521666', '2023-01-27 04:27:48.521666'), (135138680, 'admin', '$2a$04$.4XCFpiKMZF1BjVHZDG.k.drDcnupfDqE1/at5gUoEl7UkmxV0lym', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:27:48.521666', '2023-01-27 04:27:48.521666'), (369520569, 'stocker1', '$2a$04$KmAQuBEGmhaqb8GSXbq.UuzNh2uvngU5NOlBVBncD4Am4ucNS2B9a', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:27:48.521666', '2023-01-27 04:27:48.521666'), (252657165, 'stocker2', '$2a$04$NODCYJ/lfEPwPUGSQxPeDOYAlujjxcSBHpHtvWzAJYrClg1t3onfC', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:27:48.521666', '2023-01-27 04:27:48.521666')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:27:48 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "atxVt8UGC6mvndi8iRr2vBym"], ["updated_at", "2023-01-27 04:27:49.059217"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2431)
Started DELETE "/users.1" for 127.0.0.1 at 2023-01-27 04:27:49 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:28:12.567096', '2023-01-27 04:28:12.567096'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:28:12.567096', '2023-01-27 04:28:12.567096'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:28:12.567096', '2023-01-27 04:28:12.567096');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$0hPSrvIn7fdUWGQPB4Tw2.yTNbc6fd.n/FLl.IGC502UJMeG.VRHm', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:28:12.571847', '2023-01-27 04:28:12.571847'), (135138680, 'admin', '$2a$04$2aUBcB2TGbO4Tm8FwSnYA.B2wM.50.i76WTh.ciDTY9Haoeco4HSa', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:28:12.571847', '2023-01-27 04:28:12.571847'), (369520569, 'stocker1', '$2a$04$qgvdf.AY7Qef9ViDVztdt.gYPgnXI0vtNqot.TLJLHu7YWVR6LNHa', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:28:12.571847', '2023-01-27 04:28:12.571847'), (252657165, 'stocker2', '$2a$04$pxL2asfY.HiMIsg0FMGCpuIBLdVFTeXpRFuk6UHHl1ALzu707MMCq', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:28:12.571847', '2023-01-27 04:28:12.571847')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:28:12 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "d83LWt8fYZZ5pGASSkhVm7hc"], ["updated_at", "2023-01-27 04:28:13.117521"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2439)
Started DELETE "/user.1" for 127.0.0.1 at 2023-01-27 04:28:13 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:28:23.496268', '2023-01-27 04:28:23.496268'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:28:23.496268', '2023-01-27 04:28:23.496268'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:28:23.496268', '2023-01-27 04:28:23.496268');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$FDhbFa613ITt/SeJdliOweXV805z9BPzb3NcY/rPMjc6oGoDaVSHu', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:28:23.500715', '2023-01-27 04:28:23.500715'), (135138680, 'admin', '$2a$04$eYz8lqKzZEDa3tsyqySMAu7ETjTouZczT9dMR0tfxHS176yBgBrzS', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:28:23.500715', '2023-01-27 04:28:23.500715'), (369520569, 'stocker1', '$2a$04$eJdARbcBzz8jaw641.BARuHy/Ginimr8AOYWpzDFWTomf2Mr2KuqW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:28:23.500715', '2023-01-27 04:28:23.500715'), (252657165, 'stocker2', '$2a$04$2XINMdQzob8TvEFW0JSkgeHlgzA9nOED2EZxSo97c/r0LFXcHFAuq', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:28:23.500715', '2023-01-27 04:28:23.500715')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:28:23 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "iWAt4ffDcX8YHpDjGJ5FW9gV"], ["updated_at", "2023-01-27 04:28:24.034812"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2438)
Started DELETE "/user.1" for 127.0.0.1 at 2023-01-27 04:28:24 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:29:35.238831', '2023-01-27 04:29:35.238831'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:29:35.238831', '2023-01-27 04:29:35.238831'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:29:35.238831', '2023-01-27 04:29:35.238831');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$vvtKEEXUM94y4SB5QxryLuXjIBliFc2h3HhanRTOsPwL6HqA9OiNa', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:29:35.243196', '2023-01-27 04:29:35.243196'), (135138680, 'admin', '$2a$04$C6i4NvZ6YRIGIReCiRF1j.CL6Cq.YbQ.Nr6Kys1EAohP0kBHDg1fO', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:29:35.243196', '2023-01-27 04:29:35.243196'), (369520569, 'stocker1', '$2a$04$wJmI.e2kN5yLYzGJTEJVJ.jQfg9PRTLKg4JJQLlZoF.ZgajNSFxB2', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:29:35.243196', '2023-01-27 04:29:35.243196'), (252657165, 'stocker2', '$2a$04$Q9E9S.2LU0XTP4fHM72xmulqSYflxBj6/Xg3vF/AX9UJsC6OHf2du', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:29:35.243196', '2023-01-27 04:29:35.243196')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:29:35 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "eYWEseizouNkA1XAX4M3Ynuy"], ["updated_at", "2023-01-27 04:29:35.785154"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2442)
Started DELETE "/user.1" for 127.0.0.1 at 2023-01-27 04:29:35 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:29:52.619013', '2023-01-27 04:29:52.619013'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:29:52.619013', '2023-01-27 04:29:52.619013'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:29:52.619013', '2023-01-27 04:29:52.619013');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$RwixJgeLIkSRhtZoTqACtezz3DHv9Kjcv68z3cNM2/9QcFR.UYhsC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:29:52.623399', '2023-01-27 04:29:52.623399'), (135138680, 'admin', '$2a$04$run5v3xTGM.P9gfuDLbIq./QsOCtqL5d3AhhCshslONRk/jieR2JS', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:29:52.623399', '2023-01-27 04:29:52.623399'), (369520569, 'stocker1', '$2a$04$L2dZ6PUibpn8XrO.j3d1F.bQrjAEYYpGoW96cuS7B06jK7zanLyXS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:29:52.623399', '2023-01-27 04:29:52.623399'), (252657165, 'stocker2', '$2a$04$N5FjvQWdUeADzxS3.3NNRucmuMWZsdVDaIKppM2FXShtpsEf5uMCS', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:29:52.623399', '2023-01-27 04:29:52.623399')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:29:52 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "XvkRrvHmKVXVLqNm1eTQ1vwb"], ["updated_at", "2023-01-27 04:29:53.163855"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2438)
Started DELETE "/user?id=1" for 127.0.0.1 at 2023-01-27 04:29:53 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:31:12.795061', '2023-01-27 04:31:12.795061'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:31:12.795061', '2023-01-27 04:31:12.795061'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:31:12.795061', '2023-01-27 04:31:12.795061');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$tGID7ryTthEV.fcz8aBCb.k9.egQXyjg/ectCsB5tuO2fRFoZDy2q', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:31:12.799453', '2023-01-27 04:31:12.799453'), (135138680, 'admin', '$2a$04$l6pQIESGn579.vdDABKYLO.ZVBaY0MtpemWWTG.MRPRgDwyYiF9QC', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:31:12.799453', '2023-01-27 04:31:12.799453'), (369520569, 'stocker1', '$2a$04$uzTFYZGAfdgr9Q0EJDr3MOFCveh0qHO6kZgirvaIXNYcHNY8G1aQW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:31:12.799453', '2023-01-27 04:31:12.799453'), (252657165, 'stocker2', '$2a$04$Agos1ET44nk/yfXwXkxtC.vliwXVzULkb7A/jzo69/7EwY5nCNRqu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:31:12.799453', '2023-01-27 04:31:12.799453')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:31:13 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "UHQgPNfWcD6MT5ofdRqnX36q"], ["updated_at", "2023-01-27 04:31:13.357909"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 2441)
Started DELETE "/user?id=1" for 127.0.0.1 at 2023-01-27 04:31:13 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:31:20.738593', '2023-01-27 04:31:20.738593'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:31:20.738593', '2023-01-27 04:31:20.738593'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:31:20.738593', '2023-01-27 04:31:20.738593');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$gAhJBLZyS0DDdRlHdxCi6OLyEPVjgG6AK7efaluzGoZ/IaNawCwWi', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:31:20.742700', '2023-01-27 04:31:20.742700'), (135138680, 'admin', '$2a$04$wCcHXMAE11ZF75L4TLmk..2AjEzx6799hnnT9NGxCMhA92Yx2hwTS', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:31:20.742700', '2023-01-27 04:31:20.742700'), (369520569, 'stocker1', '$2a$04$ZV34NHs1BXc2tfHu9IDisuYkCB9FlMxBBpFdQpqcgfbg6Wxf26li2', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:31:20.742700', '2023-01-27 04:31:20.742700'), (252657165, 'stocker2', '$2a$04$V7vj9Zd8/EDpyVYzFuJsAeyQzvpj864age9Y2u7dUfDMR7cztiTky', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:31:20.742700', '2023-01-27 04:31:20.742700')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:31:21 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "MbPRZwk1jo3EBsWnPtBmuiSJ"], ["updated_at", "2023-01-27 04:31:21.299218"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 2441)
Started DELETE "/user?id=1" for 127.0.0.1 at 2023-01-27 04:31:21 +0000
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:32:05.767245', '2023-01-27 04:32:05.767245'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:32:05.767245', '2023-01-27 04:32:05.767245'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:32:05.767245', '2023-01-27 04:32:05.767245');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$z9Ld5R7CnG7SpMZbiXI.9OltkUYCQerOpTUA5fDIThTc5d/geAQd2', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:32:05.772275', '2023-01-27 04:32:05.772275'), (135138680, 'admin', '$2a$04$5gqtxX58W/jFHpzoYDLAFOeS8FR3mZLDcWCQ34zCcFhxaXTq6YTe6', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:32:05.772275', '2023-01-27 04:32:05.772275'), (369520569, 'stocker1', '$2a$04$zvsWXoM.jggTTejUHEV05uWNQYZ9os7lfV2mmwc86EkTeeA60s88C', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:32:05.772275', '2023-01-27 04:32:05.772275'), (252657165, 'stocker2', '$2a$04$8q4gyhN6UtdcQyO4UYU9DODBN1zRunH.8xtpOtb5GrJThk7VzLQKu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:32:05.772275', '2023-01-27 04:32:05.772275')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:32:06 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "FbC2S5gyScYCuNLtvQ8DY2hE"], ["updated_at", "2023-01-27 04:32:06.371988"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2443)
Started DELETE "/users/1" for 127.0.0.1 at 2023-01-27 04:32:06 +0000
Processing by UsersController#destroy as JSON
  Parameters: {"id"=>"1", "user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "FbC2S5gyScYCuNLtvQ8DY2hE"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 753)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:32:46.230298', '2023-01-27 04:32:46.230298'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:32:46.230298', '2023-01-27 04:32:46.230298'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:32:46.230298', '2023-01-27 04:32:46.230298');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$FmAzuR3MHas7EzoM.xow3e6bFMdZVVMYAvBCHGRd29HaGU35Q4Ifu', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:32:46.234498', '2023-01-27 04:32:46.234498'), (135138680, 'admin', '$2a$04$pFpY0ybrTeo0pzH3wznqbO/YwHZeDR4r1Rs/H0tDgC7v/x3M0Lphu', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:32:46.234498', '2023-01-27 04:32:46.234498'), (369520569, 'stocker1', '$2a$04$YzFFkwm0wIKQdCVUjnNxxevgUk.c099EpqJP3KPe.NPrdX7er6J8e', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:32:46.234498', '2023-01-27 04:32:46.234498'), (252657165, 'stocker2', '$2a$04$yaGEt8XyGAeUB3PXonzKDukUxryw752Ga/ecg4QQCCIrhrhiTzUvm', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:32:46.234498', '2023-01-27 04:32:46.234498')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:32:46 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "VGFzHwLBru4o71bsY6CqtZ9z"], ["updated_at", "2023-01-27 04:32:46.784661"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 2438)
Started DELETE "/users/746758752" for 127.0.0.1 at 2023-01-27 04:32:46 +0000
Processing by UsersController#destroy as JSON
  Parameters: {"id"=>"746758752", "user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "VGFzHwLBru4o71bsY6CqtZ9z"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Destroy (0.1ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 987)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:33:04.118962', '2023-01-27 04:33:04.118962'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:33:04.118962', '2023-01-27 04:33:04.118962'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:33:04.118962', '2023-01-27 04:33:04.118962');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$578PReJEZ97/q22enSgD2.0N7zY0I.E79JZai7vkSCWjwV/Yy9NhO', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:33:04.124204', '2023-01-27 04:33:04.124204'), (135138680, 'admin', '$2a$04$s/xTUsn5BsG5UE00tzhOO.rHXL5/bQfcLmO4r2za45.HY5i3OsaGq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:33:04.124204', '2023-01-27 04:33:04.124204'), (369520569, 'stocker1', '$2a$04$ZLJ73PvBD6sd3.3F6pqUfuGaAIj9C8TYVMdWGPdYHs6awon01XlKy', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:04.124204', '2023-01-27 04:33:04.124204'), (252657165, 'stocker2', '$2a$04$LDzW7m.D7NIPbMVJwhFBuO.2bUO0msG5CjUfXYMxmloYmtTE/l91y', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:04.124204', '2023-01-27 04:33:04.124204')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:04 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "6riq7LaGtCRfKw2ncbHZbNPR"], ["updated_at", "2023-01-27 04:33:04.723739"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2437)
Started DELETE "/users/746758752" for 127.0.0.1 at 2023-01-27 04:33:04 +0000
Processing by UsersController#destroy as JSON
  Parameters: {"id"=>"746758752", "user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "6riq7LaGtCRfKw2ncbHZbNPR"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Destroy (0.1ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 987)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:33:08.115837', '2023-01-27 04:33:08.115837'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:33:08.115837', '2023-01-27 04:33:08.115837'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:33:08.115837', '2023-01-27 04:33:08.115837');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$oFeG3LQCuBR..jA8LpHAXuIn.y0G921TZfq7c4AfxIAMWetnm0LWq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:33:08.120256', '2023-01-27 04:33:08.120256'), (135138680, 'admin', '$2a$04$5sXNEK52X/g.N.h63L6y8ubtAHz3RHzU7pJMbqzOXsZ87Eo1zLQxC', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:33:08.120256', '2023-01-27 04:33:08.120256'), (369520569, 'stocker1', '$2a$04$lEr4h4tmpmoirCf5SFuRp.c96XNM3JWznS7zBWxDG73QSFDz4tuum', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:08.120256', '2023-01-27 04:33:08.120256'), (252657165, 'stocker2', '$2a$04$DlRryuOghXT33/3Gj/3.rOS52KRQzZUwDd8qFukZve2KwOc320zF.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:08.120256', '2023-01-27 04:33:08.120256')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "CUzebaNYQvkD4koUqx5Bk3p7"], ["updated_at", "2023-01-27 04:33:08.672868"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2437)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "CUzebaNYQvkD4koUqx5Bk3p7"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 7ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 3674)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "fDYy86LJSj1eMwoLm482TLG5"], ["created_at", "2023-01-27 04:33:08.712934"], ["updated_at", "2023-01-27 04:33:08.712934"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1080)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 336)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "nnUKxjH5y2S7HhhCsPUuVxBx"], ["updated_at", "2023-01-27 04:33:08.732786"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 983)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "nnUKxjH5y2S7HhhCsPUuVxBx"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 239)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "sU6TxDG6cw4bLDMuoJwFdgzU"], ["updated_at", "2023-01-27 04:33:08.758228"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "sU6TxDG6cw4bLDMuoJwFdgzU"], ["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 256)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Q6KXk17CHjDDhQbUGHPEZ488"], ["updated_at", "2023-01-27 04:33:08.780418"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 984)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Q6KXk17CHjDDhQbUGHPEZ488"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 230)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "VBVxM1tF4jmUXoC2BAxSHyfg"], ["updated_at", "2023-01-27 04:33:08.800936"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 985)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "VBVxM1tF4jmUXoC2BAxSHyfg"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:33:08.811685"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 999)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Y82bwRsYtCCpdDbhqnKo3zKh"], ["updated_at", "2023-01-27 04:33:08.823603"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 985)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Y82bwRsYtCCpdDbhqnKo3zKh"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.7ms | Allocations: 748)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "BSTG1QXFfcLuVxjn15WsmxM3"], ["updated_at", "2023-01-27 04:33:08.849224"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 988)
Started DELETE "/users/746758752" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#destroy as JSON
  Parameters: {"id"=>"746758752", "user"=>{}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "BSTG1QXFfcLuVxjn15WsmxM3"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Destroy (0.2ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 746758752]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 719)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "DKNaAwneksjhfBX1GgMAt9qs"], ["updated_at", "2023-01-27 04:33:08.873067"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 984)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:33:08 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "DKNaAwneksjhfBX1GgMAt9qs"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:33:08.883706"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 1050)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.7ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:33:25.609678', '2023-01-27 04:33:25.609678'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:33:25.609678', '2023-01-27 04:33:25.609678'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:33:25.609678', '2023-01-27 04:33:25.609678');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$hgpYgaGDPPmkq.aKnAtKbuNpCrc5YUsh4wSXAub.6s/jEvPxHPmha', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:33:25.615073', '2023-01-27 04:33:25.615073'), (135138680, 'admin', '$2a$04$2EqncLz3AhS4vt5wy.MVjuag67mIbBmuiVRw7V.vmQjnVFwz/EcA2', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:33:25.615073', '2023-01-27 04:33:25.615073'), (369520569, 'stocker1', '$2a$04$qFlC9tBVglI5/wY/gjtWduv/NmuwiffGioi0aAO/nHgJOpAYDv/hG', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:25.615073', '2023-01-27 04:33:25.615073'), (252657165, 'stocker2', '$2a$04$Wm9SlnJXBCfFEiNlM9OijuvjXnLAVLYILz91qulpEmegge0OOgMK.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:33:25.615073', '2023-01-27 04:33:25.615073')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
SessionsControllerTest: test_should_login_then_logout
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:26 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "gxD3XfSBpm9LGuEeMbvWY2ea"], ["updated_at", "2023-01-27 04:33:26.214467"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 2437)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:33:26 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758752]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 341)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
SessionsControllerTest: test_should_not_login
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:33:26 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
Completed 401 Unauthorized in 5ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 2064)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:37:02.048043', '2023-01-27 04:37:02.048043'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:37:02.048043', '2023-01-27 04:37:02.048043'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:37:02.048043', '2023-01-27 04:37:02.048043');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$NvJmkmjCwUou1.RCNkmVoePMxC2dp.I9aOOYoqoYzpp3yM7yPC1ji', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:37:02.052306', '2023-01-27 04:37:02.052306'), (135138680, 'admin', '$2a$04$dKSqhP.FC0dW5E3lXMYKA.U2UhyKMn1Wu8fsyw96Pd9vETMCsqQke', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:37:02.052306', '2023-01-27 04:37:02.052306'), (369520569, 'stocker1', '$2a$04$9L9cuRl71PhY29/2aH6Mr.OKwc.YHmiHLL8MN4JZWLa/TuxLojOiy', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:37:02.052306', '2023-01-27 04:37:02.052306'), (252657165, 'stocker2', '$2a$04$df9llgodRvc/eQBe6pfWVOGXWCQLTvMU/ztcOjZFRuRBV3ZfuFKL6', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:37:02.052306', '2023-01-27 04:37:02.052306')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:37:02 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "scCSsZLQ4PiEMxtT9HU9EnCG"], ["updated_at", "2023-01-27 04:37:02.691945"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2436)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:37:02 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 753)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:37:52.622208', '2023-01-27 04:37:52.622208'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:37:52.622208', '2023-01-27 04:37:52.622208'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:37:52.622208', '2023-01-27 04:37:52.622208');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$KXI17mfZLH9i3f.3HT.O.uWxi7ZEhzuXPzVVbKLGPyP7lRA1rCdK2', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:37:52.628756', '2023-01-27 04:37:52.628756'), (135138680, 'admin', '$2a$04$EHBY2VmACIbJtFnHXUcOweX4ysrmR34W3qU5VTwpCqCp2v7dWexim', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:37:52.628756', '2023-01-27 04:37:52.628756'), (369520569, 'stocker1', '$2a$04$j.fIO/RjIu8jYia9daK2uehZt9kqPN7YozIomau3pPb6fRIdRc5R6', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:37:52.628756', '2023-01-27 04:37:52.628756'), (252657165, 'stocker2', '$2a$04$I9khVJ7GSd5FV/zBJHoW2.kbExZVe1d63r.yLOrtnPOCms1.ZwLFa', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:37:52.628756', '2023-01-27 04:37:52.628756')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:37:52 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "WfCtpPTxPxfvE2Msqocn5GTA"], ["updated_at", "2023-01-27 04:37:53.172946"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2431)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:37:53 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 759)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:42:33.802045', '2023-01-27 04:42:33.802045'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:42:33.802045', '2023-01-27 04:42:33.802045'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:42:33.802045', '2023-01-27 04:42:33.802045');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$AI0HCfZdFflaAtPrOoI9P..FGHigkfU87cnXn2tp4G2e/lwWYgAHW', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:42:33.806282', '2023-01-27 04:42:33.806282'), (135138680, 'admin', '$2a$04$GCF2Kif4D8byP12tvAEvn.m/6RkZBtuPxyLHDTkr6/aJZoiO1tj7W', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:42:33.806282', '2023-01-27 04:42:33.806282'), (369520569, 'stocker1', '$2a$04$DDQC3t9fgNr1GyM.6PS2H.984VGoRCxRuNa2SRpSfsVVRJBl7ZBVO', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:42:33.806282', '2023-01-27 04:42:33.806282'), (252657165, 'stocker2', '$2a$04$vXLtOqrB.SxgazSFSO0vOOgLHkaS9P3mkXIboOVO8C3pyWbRNtPd2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:42:33.806282', '2023-01-27 04:42:33.806282')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:42:34 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "7cQzZrkhtfQdnVTiLte1ekeZ"], ["updated_at", "2023-01-27 04:42:34.414570"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.9ms | Allocations: 2429)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:42:34 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "7cQzZrkhtfQdnVTiLte1ekeZ"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:42:34 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "7cQzZrkhtfQdnVTiLte1ekeZ"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:42:34.448171"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 1.0ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:42:34 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "7cQzZrkhtfQdnVTiLte1ekeZ"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:42:34.475200"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:42:34.477220"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:45:14.249426', '2023-01-27 04:45:14.249426'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:45:14.249426', '2023-01-27 04:45:14.249426'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:45:14.249426', '2023-01-27 04:45:14.249426');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$9SmLlRuC0I1TmoT/EoCrL.7bKtv2s45WsGKA1s/CrZVI1U/nqCda.', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:45:14.254284', '2023-01-27 04:45:14.254284'), (135138680, 'admin', '$2a$04$nUGfR0pq0bnh7ZjJLg39He1IH6TTUZ3NlWRfvqa4m.vJumsCgHqP2', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:45:14.254284', '2023-01-27 04:45:14.254284'), (369520569, 'stocker1', '$2a$04$m09jQRGxeilqCluhh/2bjeuAE7LLO/F1uzM4k8v3knl.nJnIqKqAq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:45:14.254284', '2023-01-27 04:45:14.254284'), (252657165, 'stocker2', '$2a$04$5gsHO/F/tG4aEFgG4ZZtMu5d28TulY8rvkhBW524ku6rUJoYnuu3y', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:45:14.254284', '2023-01-27 04:45:14.254284')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:45:14 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "3Cmh5tp5QYs9a5Ge26tzRPhW"], ["updated_at", "2023-01-27 04:45:14.845023"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2391)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:45:14 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "3Cmh5tp5QYs9a5Ge26tzRPhW"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:45:14 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "3Cmh5tp5QYs9a5Ge26tzRPhW"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:45:14.879548"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1148)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:45:14 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "3Cmh5tp5QYs9a5Ge26tzRPhW"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:45:14.907020"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:45:14.909208"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.7ms | Allocations: 4512)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:45:28.943549', '2023-01-27 04:45:28.943549'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:45:28.943549', '2023-01-27 04:45:28.943549'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:45:28.943549', '2023-01-27 04:45:28.943549');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$wsNuz6qdat1aKjZn0hKH4uL4N7CCJ4RWPsccn7CN62JF57d/O0AZu', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:45:28.948994', '2023-01-27 04:45:28.948994'), (135138680, 'admin', '$2a$04$3yuUCXMgfMQ61mvbRSEUNuZK5x61rU/VHYIk.qA3Rb5cqH23IU.rO', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:45:28.948994', '2023-01-27 04:45:28.948994'), (369520569, 'stocker1', '$2a$04$zRhlQ2Muvdqe/awPcTXFW.yTZA4rhhpn8J.Tm3LnzEOWYTlizYoQi', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:45:28.948994', '2023-01-27 04:45:28.948994'), (252657165, 'stocker2', '$2a$04$wS46qt9yZzWgjQtXAElDFONyr6vOyCQZgJhV2hGGF262NkTDkYVYa', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:45:28.948994', '2023-01-27 04:45:28.948994')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:45:29 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "H7iLxPNRekGgXYnPtmF6tbGz"], ["updated_at", "2023-01-27 04:45:29.491496"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:45:29 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "H7iLxPNRekGgXYnPtmF6tbGz"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:45:29 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "H7iLxPNRekGgXYnPtmF6tbGz"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:45:29.524886"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:45:29 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "H7iLxPNRekGgXYnPtmF6tbGz"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:45:29.552648"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:45:29.554757"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 23ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:46:38.987709', '2023-01-27 04:46:38.987709'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:46:38.987709', '2023-01-27 04:46:38.987709'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:46:38.987709', '2023-01-27 04:46:38.987709');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$WxNByq.ZmBcm41PVun5O9OXBmD5AjEPh8kXZRUgmYrAT1RJGzVRWe', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:46:38.994043', '2023-01-27 04:46:38.994043'), (135138680, 'admin', '$2a$04$h/ZmxFRH4425zXWP7y94/OAF4MZ1aMQIa42seimHo3U5NlE.ekI4O', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:46:38.994043', '2023-01-27 04:46:38.994043'), (369520569, 'stocker1', '$2a$04$G92bmWqZuxd5Y4vX3ccNUuaeRofebM7rdUsDhfwnBYGtTscRWsBtG', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:46:38.994043', '2023-01-27 04:46:38.994043'), (252657165, 'stocker2', '$2a$04$OdwnMHLFTS713YHDtGc8VOprn62/chHm8kr660wb95uz8Qe5Sz0ZW', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:46:38.994043', '2023-01-27 04:46:38.994043')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:46:39 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "JkR3c3gEKN7i5n6BNGGF8fwC"], ["updated_at", "2023-01-27 04:46:39.544651"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2433)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:46:39 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "JkR3c3gEKN7i5n6BNGGF8fwC"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:46:39 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "JkR3c3gEKN7i5n6BNGGF8fwC"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:46:39.577418"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:46:39 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "JkR3c3gEKN7i5n6BNGGF8fwC"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:46:39.604839"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:46:39.607242"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 23ms (Views: 0.1ms | ActiveRecord: 1.8ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:47:52.650773', '2023-01-27 04:47:52.650773'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:47:52.650773', '2023-01-27 04:47:52.650773'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:47:52.650773', '2023-01-27 04:47:52.650773');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$0TQYI4Oy8HQaa/PNu9FhwOER7j0XlE3mhF8RTMK0iEs4Wow8tnP.O', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:47:52.657051', '2023-01-27 04:47:52.657051'), (135138680, 'admin', '$2a$04$saVV/iElEqklsaWSLGf0FOhbJLLLuFNN69MFwJRvPmX0WdiiTG6.e', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:47:52.657051', '2023-01-27 04:47:52.657051'), (369520569, 'stocker1', '$2a$04$AmvHRJ64a24eaFMNCeNXb.yRjvI.NzEgKVqfyByUUYcWe1fKI1VVS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:47:52.657051', '2023-01-27 04:47:52.657051'), (252657165, 'stocker2', '$2a$04$G.IcQTUJJBh7pZNtXt4/W.WmdcLQZMStE7cbZ6sbGyn6AXHjVJd0u', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:47:52.657051', '2023-01-27 04:47:52.657051')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:47:53 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "oQRP63Cp6tA23R9t99v4v1jn"], ["updated_at", "2023-01-27 04:47:53.246596"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2430)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:47:53 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "oQRP63Cp6tA23R9t99v4v1jn"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:47:53 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "oQRP63Cp6tA23R9t99v4v1jn"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:47:53.281259"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:47:53 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "oQRP63Cp6tA23R9t99v4v1jn"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:47:53.310886"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:47:53.313268"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 25ms (Views: 0.1ms | ActiveRecord: 1.7ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:48:20.309697', '2023-01-27 04:48:20.309697'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:48:20.309697', '2023-01-27 04:48:20.309697'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:48:20.309697', '2023-01-27 04:48:20.309697');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$jpLB6xN.YJFjOwupgRY3ju7pWLDE6sQONtpZ1idWt1AKwu/PJNh8G', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:48:20.314880', '2023-01-27 04:48:20.314880'), (135138680, 'admin', '$2a$04$kKPYogSZtssiZGNZqHrJ0O/fbhRqfkmwmuVPDUw35EZDdzs8u7xT.', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:48:20.314880', '2023-01-27 04:48:20.314880'), (369520569, 'stocker1', '$2a$04$Peqe79aFuXym8F6P12zDG.DNxM0BAJMZnW5xzDGC6rIkv2vcuz8By', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:48:20.314880', '2023-01-27 04:48:20.314880'), (252657165, 'stocker2', '$2a$04$UHeRg6pt2s1EO80/uE4AiuVjVmp.AviZBdBGmfCbDHGAeYJXqGfPu', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:48:20.314880', '2023-01-27 04:48:20.314880')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:48:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "1jSFfyq1gTuCLR5AJLBnoP7z"], ["updated_at", "2023-01-27 04:48:20.844902"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2429)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:48:20 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1jSFfyq1gTuCLR5AJLBnoP7z"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 771)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:48:20 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1jSFfyq1gTuCLR5AJLBnoP7z"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:48:20.877707"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:48:20 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1jSFfyq1gTuCLR5AJLBnoP7z"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:48:20.904275"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:48:20.906326"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:49:17.689291', '2023-01-27 04:49:17.689291'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:49:17.689291', '2023-01-27 04:49:17.689291'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:49:17.689291', '2023-01-27 04:49:17.689291');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$cNFkyH8YxDMM5QJX50D5IO4kbBc9EhgqKBPixnX9YV5wDpwvTykcq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:49:17.695266', '2023-01-27 04:49:17.695266'), (135138680, 'admin', '$2a$04$Z6423QIKu8GI0rIcSLL7t.fkLnie6Mybp5W0og3Xw8zyoC8rFSDOq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:49:17.695266', '2023-01-27 04:49:17.695266'), (369520569, 'stocker1', '$2a$04$8W35xdKQftXGgvVAo0BZsOlrZzBoL91gncKkhV3A/T/EJBKZaTApu', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:49:17.695266', '2023-01-27 04:49:17.695266'), (252657165, 'stocker2', '$2a$04$w4f81N6A8KoPUQZ/y1wN..iAPhVnvBhKsEDWyYWQOhCb42pfwHRA.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:49:17.695266', '2023-01-27 04:49:17.695266')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:49:18 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "883jLGJaBuc1w9BtL6B1uHkC"], ["updated_at", "2023-01-27 04:49:18.242450"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2390)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:49:18 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "883jLGJaBuc1w9BtL6B1uHkC"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:49:18 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "883jLGJaBuc1w9BtL6B1uHkC"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:49:18.274838"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1148)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:49:18 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "883jLGJaBuc1w9BtL6B1uHkC"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:49:18.301737"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:49:18.303865"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:49:33.997655', '2023-01-27 04:49:33.997655'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:49:33.997655', '2023-01-27 04:49:33.997655'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:49:33.997655', '2023-01-27 04:49:33.997655');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$.w.Xqq8ItuiYdRVMrBqrEeAhpXrZs4hHb3rYViC58LQbLAwTCg1wq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:49:34.001823', '2023-01-27 04:49:34.001823'), (135138680, 'admin', '$2a$04$WJlgMNskyPD2xpJK5ey8GuZNtHLhQJgay0bHlMrPY0.A8FCoIePHy', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:49:34.001823', '2023-01-27 04:49:34.001823'), (369520569, 'stocker1', '$2a$04$7grftG.J09BXpnfR.U3uzuFQ3E7C73YIzVzwqvIaHBbthS9Xrru/e', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:49:34.001823', '2023-01-27 04:49:34.001823'), (252657165, 'stocker2', '$2a$04$j3hiG2toVj5648GLNCcFx.2WN4kZFZfkA39a2HjJYRZrpykaOd99C', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:49:34.001823', '2023-01-27 04:49:34.001823')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:49:34 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Unp7m75SUDNoBQPK2q85ieVR"], ["updated_at", "2023-01-27 04:49:34.583982"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 2431)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:49:34 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Unp7m75SUDNoBQPK2q85ieVR"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:49:34 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Unp7m75SUDNoBQPK2q85ieVR"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:49:34.616904"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:49:34 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Unp7m75SUDNoBQPK2q85ieVR"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:49:34.643510"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:49:34.645549"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:50:12.187053', '2023-01-27 04:50:12.187053'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:50:12.187053', '2023-01-27 04:50:12.187053'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:50:12.187053', '2023-01-27 04:50:12.187053');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$CVG8RDoGlkfDwRpcR1YWcOERKyLDF3CpvzjeyCmDvWmdl8jsysdeq', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:50:12.192537', '2023-01-27 04:50:12.192537'), (135138680, 'admin', '$2a$04$mUoLEpoogvnrokcn0qTsMO8AxfoKv0MsFJpsCAY5jdEcXdWRfqKHW', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:50:12.192537', '2023-01-27 04:50:12.192537'), (369520569, 'stocker1', '$2a$04$9r4baejZACswjToSTQhWCOnj4NaL/WeUO8iknWXIziChS6pRQOuXy', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:50:12.192537', '2023-01-27 04:50:12.192537'), (252657165, 'stocker2', '$2a$04$h1hpn5BJDOhExe/UrFWPVuoFHB/RbswfmXGer36dEvRaRYAJaFSb2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:50:12.192537', '2023-01-27 04:50:12.192537')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:50:12 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "1wxHtf1eRsT8HhN73zuY1knW"], ["updated_at", "2023-01-27 04:50:12.762836"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.5ms | ActiveRecord: 1.5ms | Allocations: 2434)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:50:12 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1wxHtf1eRsT8HhN73zuY1knW"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:50:12 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1wxHtf1eRsT8HhN73zuY1knW"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:50:12.813332"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:50:12 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "1wxHtf1eRsT8HhN73zuY1knW"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.3ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:50:12.846183"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:50:12.849406"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 29ms (Views: 0.1ms | ActiveRecord: 2.2ms | Allocations: 4531)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (1.0ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.3ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:53:35.422400', '2023-01-27 04:53:35.422400'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:53:35.422400', '2023-01-27 04:53:35.422400'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:53:35.422400', '2023-01-27 04:53:35.422400');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$SpRuc0BdP8TrFYe2Cul/XehIY0NG5GUaregbIq0ryH13lUiu2AdKy', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:53:35.428112', '2023-01-27 04:53:35.428112'), (135138680, 'admin', '$2a$04$l0F7YyioK.Yj.xs6bLg1gO1WSUNslQylFUpN/yaY1OLVtgYNbSpdq', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:53:35.428112', '2023-01-27 04:53:35.428112'), (369520569, 'stocker1', '$2a$04$giw0eDpEepCaK6Rm3gdVvuCXBJ5TK7yB1XImt3xaURXRVNyGIdHxq', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:53:35.428112', '2023-01-27 04:53:35.428112'), (252657165, 'stocker2', '$2a$04$5jyN6T75S4JQ2m9R65g/9OeIg/VzV6kgoPkOwMdbhOKJIvWDF/hu2', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:53:35.428112', '2023-01-27 04:53:35.428112')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:53:35 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "zqFCnC1mkiNGoyeYraxehQ2W"], ["updated_at", "2023-01-27 04:53:36.024223"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 2431)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:53:36 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "zqFCnC1mkiNGoyeYraxehQ2W"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:53:36 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "zqFCnC1mkiNGoyeYraxehQ2W"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:53:36.057105"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:53:36 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "zqFCnC1mkiNGoyeYraxehQ2W"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:53:36.083483"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:53:36.085518"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
Started GET "/products/890792488" for 127.0.0.1 at 2023-01-27 04:53:38 +0000
Processing by ProductsController#show as HTML
  Parameters: {"id"=>"890792488"}
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.8ms | ActiveRecord: 1.0ms | Allocations: 57291)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:53:59.078843', '2023-01-27 04:53:59.078843'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:53:59.078843', '2023-01-27 04:53:59.078843'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:53:59.078843', '2023-01-27 04:53:59.078843');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$rZoZxlqbajRcHinhJXD4ye.ba4DnNxK6OU3mmRd0OuSnUA1IXqSTW', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:53:59.084482', '2023-01-27 04:53:59.084482'), (135138680, 'admin', '$2a$04$ezPnleQ1SKgt6RATYsb1bOEo3UkXtQr6Lqa8w3VyfxwTC7VbsyGjW', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:53:59.084482', '2023-01-27 04:53:59.084482'), (369520569, 'stocker1', '$2a$04$moaHtbiw8h6A.qi7we2aTO60I232DRVFf9nSjeNwGbWv8QdnFDyaW', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:53:59.084482', '2023-01-27 04:53:59.084482'), (252657165, 'stocker2', '$2a$04$oIeeAjlVO6Z.UJCBOcq36.sTB8y06bdOqYBIqgXm2NFKeMsqvigyK', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:53:59.084482', '2023-01-27 04:53:59.084482')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:53:59 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "HY2cz3b2ia4PmkbAGNF22jf5"], ["updated_at", "2023-01-27 04:53:59.624838"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2390)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:53:59 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "HY2cz3b2ia4PmkbAGNF22jf5"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:53:59 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "HY2cz3b2ia4PmkbAGNF22jf5"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:53:59.660566"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1148)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:53:59 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "HY2cz3b2ia4PmkbAGNF22jf5"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:53:59.687755"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:53:59.689786"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 4531)
Started GET "/products/890792488" for 127.0.0.1 at 2023-01-27 04:54:00 +0000
Processing by ProductsController#show as HTML
  Parameters: {"id"=>"890792488"}
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 1288)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:54:20.160564', '2023-01-27 04:54:20.160564'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:54:20.160564', '2023-01-27 04:54:20.160564'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:54:20.160564', '2023-01-27 04:54:20.160564');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$yZL4XVKJhRMnuecLOj1qMeuHpbXjOWJov3cjqc3fYroubrpop.Zne', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:54:20.168545', '2023-01-27 04:54:20.168545'), (135138680, 'admin', '$2a$04$M7F.UemflxS27q29dgJrdesxedhWXDWVzN0neZ9o9DKq/9h0otNoe', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:54:20.168545', '2023-01-27 04:54:20.168545'), (369520569, 'stocker1', '$2a$04$UhfeSlouEC25hb7M2n9wEuaQ38oTRbSecYdyHHb68DKNIQ9iZoc4e', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:20.168545', '2023-01-27 04:54:20.168545'), (252657165, 'stocker2', '$2a$04$L38TYUQp6JTNjfhXfP4SV.ZWcgPiyHyQ2t8EA9mdp/h/hcnI9B3K.', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:20.168545', '2023-01-27 04:54:20.168545')[0m
  [1m[36mTRANSACTION (89.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
ProductsControllerTest: test_should_buy_product
-----------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:20 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "8rN9Z9n4vxzQAJojACB5oxbd"], ["updated_at", "2023-01-27 04:54:20.810854"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2430)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:54:20 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "8rN9Z9n4vxzQAJojACB5oxbd"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 768)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:54:20 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "8rN9Z9n4vxzQAJojACB5oxbd"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:54:20.843591"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 1127)
Started POST "/buy" for 127.0.0.1 at 2023-01-27 04:54:20 +0000
Processing by ProductsController#buy as JSON
  Parameters: {"amount"=>1, "product_id"=>890792488, "product"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "8rN9Z9n4vxzQAJojACB5oxbd"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mProduct Update (0.2ms)[0m  [1m[33mUPDATE "products" SET "amount_available" = $1, "updated_at" = $2 WHERE "products"."id" = $3[0m  [["amount_available", 4], ["updated_at", "2023-01-27 04:54:20.871037"], ["id", 890792488]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 0], ["updated_at", "2023-01-27 04:54:20.873058"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 23ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 4531)
Started GET "/products/890792488" for 127.0.0.1 at 2023-01-27 04:54:20 +0000
Processing by ProductsController#show as HTML
  Parameters: {"id"=>"890792488"}
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 890792488], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 465)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:54:26.227017', '2023-01-27 04:54:26.227017'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:54:26.227017', '2023-01-27 04:54:26.227017'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:54:26.227017', '2023-01-27 04:54:26.227017');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$AysXjQFPgzGi4TVp5Ko4merwq2hAShcz/V1A.PXA8uBMztwQKgWMK', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:54:26.231251', '2023-01-27 04:54:26.231251'), (135138680, 'admin', '$2a$04$lKwakLrZdk2Ip6TzNDocW.fNsGdmBJpeQVODBrViBgGpCMYmY2iky', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:54:26.231251', '2023-01-27 04:54:26.231251'), (369520569, 'stocker1', '$2a$04$6hbkZGDZFBuNLpUwqGuN3O52PXMFHz6wNkM8DbL72emVCGspjEYiG', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:26.231251', '2023-01-27 04:54:26.231251'), (252657165, 'stocker2', '$2a$04$imqxZFU7lsRqcyHhtpC.ie5mZwfNv10UJTqacpa.5TkeUnx5FPkam', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:26.231251', '2023-01-27 04:54:26.231251')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
SessionsControllerTest: test_should_login_then_logout
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:26 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "j2WsX2uYgYR8QKurwKsuSSw2"], ["updated_at", "2023-01-27 04:54:26.756500"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 2433)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:54:26 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758752]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 341)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
SessionsControllerTest: test_should_not_login
---------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:26 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
Completed 401 Unauthorized in 5ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 2064)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mUser Pluck (0.8ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.2ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mUser Pluck (0.1ms)[0m  [1m[34mSELECT "users"."id" FROM "users" WHERE "users"."role" = $1[0m  [["role", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "products" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[31mDELETE FROM "products";
DELETE FROM "users";
INSERT INTO "products" ("id", "name", "amount_available", "cost", "seller_id", "created_at", "updated_at") VALUES (890792488, 'Mars', 5, 80, 369520569, '2023-01-27 04:54:31.340745', '2023-01-27 04:54:31.340745'), (1044824035, 'Twix', 0, 95, 369520569, '2023-01-27 04:54:31.340745', '2023-01-27 04:54:31.340745'), (209893330, 'Kit Kat', 2, 125, 252657165, '2023-01-27 04:54:31.340745', '2023-01-27 04:54:31.340745');
INSERT INTO "users" ("id", "username", "password_digest", "email", "role", "deposit", "auth_token", "created_at", "updated_at") VALUES (746758752, 'mingos', '$2a$04$KI.JlCxlvLaX2pw9qgb22evGwlIGoToRzkBrH8LiPCD3Af7oomKyC', 'mingos@mail.com', 1, 10, DEFAULT, '2023-01-27 04:54:31.346547', '2023-01-27 04:54:31.346547'), (135138680, 'admin', '$2a$04$FIkk/EYrHLh5xK8fpScR8.9gglrJgYvy.4eguYcY3XkNtfRojIqDK', 'admin@mail.com', 0, 0, DEFAULT, '2023-01-27 04:54:31.346547', '2023-01-27 04:54:31.346547'), (369520569, 'stocker1', '$2a$04$2BWJQwEuD4..W9N1t7Xy3.mXk0HF9GSvmS1gyZeX/cmpoat4BMwnS', 'stocker1@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:31.346547', '2023-01-27 04:54:31.346547'), (252657165, 'stocker2', '$2a$04$99xj1/r3s1STKZ1.tM0Wh.rkG3m1upe66RygQ1BxZTYNm.sZQXrwW', 'stocker2@mail.com', 2, 0, DEFAULT, '2023-01-27 04:54:31.346547', '2023-01-27 04:54:31.346547')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "products" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UsersControllerTest: test_should_create_user_then_logout_then_login_then_show_info
----------------------------------------------------------------------------------
Started POST "/users" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by UsersController#create as JSON
  Parameters: {"user"=>{"username"=>"Test", "email"=>"test@mail.com", "role"=>"buyer", "deposit"=>0, "password"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@mail.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("username", "password_digest", "email", "auth_token", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["username", "Test"], ["password_digest", "[FILTERED]"], ["email", "test@mail.com"], ["auth_token", "9p3gqQ1n7VVPcVDTwnSkCpYL"], ["created_at", "2023-01-27 04:54:31.889195"], ["updated_at", "2023-01-27 04:54:31.889195"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 6944)
Started DELETE "/logout/all" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by SessionsController#destroy as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1 WHERE "users"."id" = $2[0m  [["auth_token", nil], ["id", 746758753]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 734)
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"Test", "password"=>"[FILTERED]", "session"=>{"username"=>"Test", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "Test"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "Test"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test@mail.com"], ["id", 746758753], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "oSr5QmhbbM5rUx4JgWzTFoDs"], ["updated_at", "2023-01-27 04:54:31.921138"], ["id", 746758753]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1134)
Started GET "/profile" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by UsersController#profile as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "oSr5QmhbbM5rUx4JgWzTFoDs"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 396)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
UsersControllerTest: test_as_normal_user_should_not_show_info_about_users
-------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "DgUy7i3dQyTVEcJF6NM3gBw5"], ["updated_at", "2023-01-27 04:54:31.946490"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 986)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "DgUy7i3dQyTVEcJF6NM3gBw5"], ["LIMIT", 1]]
Filter chain halted as :check_if_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 243)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
UsersControllerTest: test_should_not_update_user_email
------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "ALDHGwSJGGB7rugnmw1ZeR9Q"], ["updated_at", "2023-01-27 04:54:31.967367"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.3ms | Allocations: 986)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"admin@mail.com", "user"=>{"email"=>"admin@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "ALDHGwSJGGB7rugnmw1ZeR9Q"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 6ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 3350)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UsersControllerTest: test_as_admin_should_delete_user
-----------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "R3YJpQ1SDZ7m46MZMjymhgA9"], ["updated_at", "2023-01-27 04:54:31.993366"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 985)
Started DELETE "/users/746758752" for 127.0.0.1 at 2023-01-27 04:54:31 +0000
Processing by UsersController#destroy as JSON
  Parameters: {"id"=>"746758752", "user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "R3YJpQ1SDZ7m46MZMjymhgA9"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Destroy (0.2ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 719)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UsersControllerTest: test_should_not_post_deposit
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "o84VVTKi5CJLWHzCD7zjrm94"], ["updated_at", "2023-01-27 04:54:32.014734"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 986)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>60, "user"=>{"deposit"=>60}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "o84VVTKi5CJLWHzCD7zjrm94"], ["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 251)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
UsersControllerTest: test_as_admin_should_show_info_about_users
---------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 135138680], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"admin", "password"=>"[FILTERED]", "session"=>{"username"=>"admin", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "admin"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "admin"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "admin@mail.com"], ["id", 135138680], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "UMNbrqxxYXezWLa6bok7y9Gz"], ["updated_at", "2023-01-27 04:54:32.035513"], ["id", 135138680]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 984)
Started GET "/users" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by UsersController#index as JSON
  Parameters: {"user"=>{}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "UMNbrqxxYXezWLa6bok7y9Gz"], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" ORDER BY "users"."id" ASC[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 748)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 369520569], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 252657165], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UsersControllerTest: test_should_post_deposit
---------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "ZEack3xXcFaqxcMW8xkc3pPD"], ["updated_at", "2023-01-27 04:54:32.058738"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 967)
Started POST "/deposit" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by UsersController#deposit as JSON
  Parameters: {"deposit"=>100, "user"=>{"deposit"=>100}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "ZEack3xXcFaqxcMW8xkc3pPD"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "deposit" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["deposit", 110], ["updated_at", "2023-01-27 04:54:32.068813"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 999)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
UsersControllerTest: test_should_update_user_email
--------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 746758752], ["LIMIT", 1]]
Started POST "/login" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by SessionsController#create as JSON
  Parameters: {"username"=>"mingos", "password"=>"[FILTERED]", "session"=>{"username"=>"mingos", "password"=>"[FILTERED]"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."username" = $1 LIMIT $2[0m  [["username", "mingos"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "mingos@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "auth_token" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["auth_token", "Z4L1fBQ8KPgiHucq8hxQ1XQc"], ["updated_at", "2023-01-27 04:54:32.080863"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 986)
Started PUT "/user" for 127.0.0.1 at 2023-01-27 04:54:32 +0000
Processing by UsersController#update as JSON
  Parameters: {"email"=>"test_use_case@mail.com", "user"=>{"email"=>"test_use_case@mail.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."auth_token" = $1 LIMIT $2[0m  [["auth_token", "Z4L1fBQ8KPgiHucq8hxQ1XQc"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."username" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["username", "mingos"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "test_use_case@mail.com"], ["id", 746758752], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "email" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["email", "test_use_case@mail.com"], ["updated_at", "2023-01-27 04:54:32.091287"], ["id", 746758752]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1031)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
